<!--
@license https://github.com/t2ym/i18n-behavior/blob/master/LICENSE.md
Copyright (c) 2016, Tetsuya Mori <t2y3141592@gmail.com>. All rights reserved.
--><html lang="en" preferred=""><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">

    <script src="../../../webcomponentsjs/webcomponents.js"></script>
    <script src="../../../web-component-tester/browser.js"></script>

    <link rel="import" href="../../i18n-behavior.html">
    <link rel="import" href="simple-text-element/simple-text-element.html">
    <link rel="import" href="commented-simple-text-element/commented-simple-text-element.html">
    <link rel="import" href="plural-gender-element/plural-gender-element.html">
    <link rel="import" href="simple-attribute-element/simple-attribute-element.html">
    <link rel="import" href="fallback-text-element/fallback-text-element.html">
    <link rel="import" href="compound-binding-element/compound-binding-element.html">
    <link rel="import" href="simple-text-id-element/simple-text-id-element.html">
    <style>
    .test-container.running-test {
      display: block;
    }
    .test-container:not(.running-test) { 
      display: none;
    }
    </style>
  </head>
  <body>
    <h2 id="test-name"></h2>

    <test-fixture class="test-container" id="simple-text-element-default-fixture">
      <template>
        <simple-text-element></simple-text-element>
      </template>
    </test-fixture>

    <test-fixture class="test-container" id="commented-simple-text-element-default-fixture">
      <template>
        <commented-simple-text-element></commented-simple-text-element>
      </template>
    </test-fixture>

    <test-fixture class="test-container" id="simple-text-element-fixture">
      <template is="dom-template" id="bound-simple-text-element">
        <simple-text-element lang="{{lang}}" observe-html-lang="{{observeHtmlLang}}">
        </simple-text-element>
      </template>
    </test-fixture>

    <test-fixture class="test-container" id="commented-simple-text-element-fixture">
      <template is="dom-template" id="bound-commented-simple-text-element">
        <commented-simple-text-element lang="{{lang}}" observe-html-lang="{{observeHtmlLang}}">
        </commented-simple-text-element>
      </template>
    </test-fixture>

    <test-fixture class="test-container" id="simple-text-id-element-fixture">
      <template is="dom-template" id="bound-simple-text-id-element">
        <simple-text-id-element lang="{{lang}}" observe-html-lang="{{observeHtmlLang}}">
        </simple-text-id-element>
      </template>
    </test-fixture>

    <test-fixture class="test-container" id="plural-gender-element-fixture">
      <template is="dom-template">
        <plural-gender-element lang="{{lang}}" observe-html-lang="{{observeHtmlLang}}" sender="{{sender}}" recipients="{{recipients}}">
        </plural-gender-element>
      </template>
    </test-fixture>


    <test-fixture class="test-container" id="simple-attribute-element-fixture">
      <template is="dom-template">
        <simple-attribute-element lang="{{lang}}" observe-html-lang="{{observeHtmlLang}}">
        </simple-attribute-element>
      </template>
    </test-fixture>

    <test-fixture class="test-container" id="fallback-text-element-fixture">
      <template is="dom-template">
        <fallback-text-element lang="{{lang}}" observe-html-lang="{{observeHtmlLang}}">
        </fallback-text-element>
      </template>
    </test-fixture>

    <test-fixture class="test-container" id="compound-binding-element-fixture">
      <template is="dom-template">
        <compound-binding-element lang="{{lang}}" observe-html-lang="{{observeHtmlLang}}" param1="{{param1}}" param2="{{param2}}">
        </compound-binding-element>
      </template>
    </test-fixture>

    <div class="test-container">
      <template id="simple-text-dom-bind" is="i18n-dom-bind" assetpath="/" localizable-text="embedded">{{text.text}}<div><div></div></div><!-- nested empty div -->
        <span id="whitespace"> &nbsp; </span>
        <h1>{{text.h1_3}}</h1>{{text.text_4}}<span>{{text.span_5}}</span>
        <span>{{text.span_6}}</span>
        <span id="label-1">{{text.label-1}}</span>
        <span id="label-2">{{text.label-2}}</span>
        <div>
          <span>{{text.div_9:span}}</span> 
          <span>{{text.div_9:span_1}}</span> 
          <div><div>{{text.div_9:div_2:div}}</div></div> 
        </div>
        <div>{{text.div_10:text}}<span>{{text.div_10:span_1}}</span>{{text.div_10:text_2}}<span>{{text.div_10:span_3}}</span>
          <div><div>{{text.div_10:div_4:div}}</div></div>{{text.div_10:text_5}}</div>
        <div id="toplevel-div">
          <span>{{text.toplevel-div:span}}</span>
          <span>{{text.toplevel-div:span_1}}</span>
          <div id="second-level-div">
            <div id="third-level-div">{{text.third-level-div}}</div>
            <div>{{text.second-level-div:div_1}}</div>
          </div>
        </div>
        <div>
          <ul>
            <li>{{text.div_12:ul:li}}</li>
            <li>{{text.div_12:ul:li_1}}</li>
            <li>{{text.div_12:ul:li_2}}</li>
          </ul>
          <ul id="line-items">
            <li>{{text.line-items:li}}</li>
            <li>{{text.line-items:li_1}}</li>
            <li>{{text.line-items:li_2}}</li>
          </ul>
        </div>
        <p><i18n-format lang="{{effectiveLang}}"><span>{{text.p_13.0}}</span><b param="1">{{text.p_13.1}}</b><code param="2">{{text.p_13.2}}</code></i18n-format></p>
        <p id="paragraph"><i18n-format lang="{{effectiveLang}}"><span>{{text.paragraph.0}}</span><b param="1">{{text.paragraph.1}}</b><code param="2">{{text.paragraph.2}}</code></i18n-format></p>{{text.text_15}}<template id="localizable-text">
<json-data>
{
  "meta": {},
  "model": {},
  "text": " outermost text at the beginning ",
  "h1_3": "outermost header 1",
  "text_4": " outermost text in the middle ",
  "span_5": "simple text without id",
  "span_6": "simple text without id 2",
  "label-1": "simple text with id",
  "label-2": "simple text with id 2",
  "div_9:span": "simple text within div",
  "div_9:span_1": "simple text within div 2",
  "div_9:div_2:div": "great grandchild text within div",
  "div_10:text": " simple text as the first element in div ",
  "div_10:span_1": "simple text within div",
  "div_10:text_2": " simple text in the middle of div ",
  "div_10:span_3": "simple text within div 2",
  "div_10:div_4:div": "great grandchild text within div",
  "div_10:text_5": " simple text at the last element in div ",
  "toplevel-div:span": "simple text within div",
  "toplevel-div:span_1": "simple text within div 2",
  "third-level-div": "great grandchild text within div",
  "second-level-div:div_1": "great grandchild text within div without id",
  "div_12:ul:li": "line item without id 1",
  "div_12:ul:li_1": "line item without id 2",
  "div_12:ul:li_2": "line item without id 3",
  "line-items:li": "line item with id 1",
  "line-items:li_1": "line item with id 2",
  "line-items:li_2": "line item with id 3",
  "p_13": [
    "A paragraph with {1} is converted to {2}.",
    "parameters",
    "&lt;i18n-format&gt;"
  ],
  "paragraph": [
    "A paragraph with {1} is converted to {2}.",
    "id",
    "&lt;i18n-format&gt;"
  ],
  "text_15": " outermost text at the end "
}
</json-data>
</template>
</template>
    </div>

    <div class="test-container">
      <template id="simple-attribute-dom-bind" is="i18n-dom-bind" assetpath="/" localizable-text="embedded">
        <style attr="This is not extracted">
        google-chart {
          width: 300px;
        }
        </style>
        <div id="outer-div">
          <div id="ordinary-div" attr="This is not targeted for extraction">{{text.ordinary-div}}</div>

          <input id="standard-input" placeholder="{{model.standard-input.placeholder}}">
          <input placeholder="{{model.outer-div:input_2.placeholder}}">

          <paper-input id="paper-input-element" label="{{model.paper-input-element.label}}" error-message="{{model.paper-input-element.error-message}}" placeholder="{{model.paper-input-element.placeholder}}" value="this is not a target">
          </paper-input>

          <paper-input label="{{model.outer-div:paper-input_4.label}}" error-message="{{model.outer-div:paper-input_4.error-message}}" placeholder="{{model.outer-div:paper-input_4.placeholder}}" value="this is not a target">
          </paper-input>

          <google-chart type="pie" id="pie-chart" options="{{model.pie-chart.options}}" cols="{{model.pie-chart.cols}}" rows="{{model.pie-chart.rows}}">
          </google-chart>

          <google-chart id="column-chart" type="column" options="{{model.column-chart.options}}" data="{{model.column-chart.data}}">
          </google-chart>

          <text-attribute-element id="custom-attr" custom-text-attr1="{{model.custom-attr.custom-text-attr1}}" custom-text-attr2="{{model.custom-attr.custom-text-attr2}}" custom-text-attr3="{{model.custom-attr.custom-text-attr3}}" out-of-scope-attr="out of scope attr">
          </text-attribute-element>

          <span id="test-json-data-1">{{model.json-data-id.attr1}}</span>
          <span id="test-json-data-2">{{model.json-data-id.i18n-target-attr}}</span>
          <span id="test-json-data-3">{{model.template_2:json-data_1.attr1}}</span>
          <span id="test-json-data-4">{{model.template_2:json-data_1.i18n-target-attr}}</span>

        </div>
        <template>
          <json-data id="json-data-id" attr1="{{model.json-data-id.attr1}}" i18n-target-attr="{{model.json-data-id.i18n-target-attr}}"></json-data>
          <json-data attr1="{{model.template_2:json-data_1.attr1}}" i18n-target-attr="{{model.template_2:json-data_1.i18n-target-attr}}"></json-data>
        </template>
      <template id="localizable-text">
<json-data>
{
  "meta": {},
  "model": {
    "standard-input": {
      "placeholder": "standard HTML5 attribute"
    },
    "outer-div:input_2": {
      "placeholder": "standard HTML5 attribute without id"
    },
    "paper-input-element": {
      "label": "paper-input label",
      "error-message": "paper-input error message",
      "placeholder": "paper-input placeholder"
    },
    "outer-div:paper-input_4": {
      "label": "paper-input label without id",
      "error-message": "paper-input error message without id",
      "placeholder": "paper-input placeholder without id"
    },
    "pie-chart": {
      "options": {
        "title": "Distribution of days in 2001H1"
      },
      "cols": [
        {
          "label": "Month",
          "type": "string"
        },
        {
          "label": "Days",
          "type": "number"
        }
      ],
      "rows": [
        [
          "Jan",
          31
        ],
        [
          "Feb",
          28
        ],
        [
          "Mar",
          31
        ],
        [
          "Apr",
          30
        ],
        [
          "May",
          31
        ],
        [
          "Jun",
          30
        ]
      ]
    },
    "column-chart": {
      "options": {
        "title": "Inventory"
      },
      "data": [
        [
          "Year",
          "Things",
          "Stuff"
        ],
        [
          "2004",
          1000,
          400
        ],
        [
          "2005",
          1170,
          460
        ],
        [
          "2006",
          660,
          1120
        ],
        [
          "2007",
          1030,
          540
        ]
      ]
    },
    "custom-attr": {
      "custom-text-attr1": "custom text attribute 1",
      "custom-text-attr2": "custom text attribute 2",
      "custom-text-attr3": "custom text attribute 3"
    },
    "json-data-id": {
      "attr1": "this attr1 is extracted",
      "i18n-target-attr": "this attribute is also extracted"
    },
    "template_2:json-data_1": {
      "attr1": "this attr1 without id is extracted",
      "i18n-target-attr": "this attribute without id is also extracted"
    }
  },
  "ordinary-div": "text 1"
}
</json-data>
</template>
</template>
    </div>
    <script>
      var bind = document.querySelector('template#simple-attribute-dom-bind');

      window.addEventListener('dom-change', function onDomChangeForBind (event) {
        if (event.target === bind) {
          bind._langUpdated = function (e) {
            if (Polymer.dom(e).rootTarget === this) {
              //console.log('bind._langUpdated: ' + this.is + ' ' + this.id + ' ' + e.type + ' ' + this.lang);
              //console.log('bind._langUpdated: deepcopying model for lang ' + this.lang);
              this.model = deepcopy(this.text.model);
              this.notifyPath('model', this.model);
              this.render();
            }
          };

          bind._onDomChangeAfterLangUpdated = function (e) {
            //console.log('bind._onDomChangeAfterLangUpdated ' + this.is + ' ' + this.id + ' ' + e.type + ' ' + this.lang);
            if (this.params && this.params.lang === this.lang) {
              //console.log('bind._onDomChangeAfterLangUpdated ' + this.is + ' ' + this.id + ' ' + e.type + ' firing local-dom-ready');
              this.fire('local-dom-ready');
            }
          };

          bind.listen(bind, 'lang-updated', '_langUpdated');
          bind.listen(bind, 'dom-change', '_onDomChangeAfterLangUpdated');

          window.removeEventListener('dom-change', onDomChangeForBind);
        }
      });
    </script>

    <div class="test-container">
      <template id="compound-binding-dom-bind" is="i18n-dom-bind" assetpath="/" localizable-text="embedded"><i18n-format lang="{{effectiveLang}}"><span>{{text.text.0}}</span><span param="1">{{param1}}</span><span param="2">{{param2}}</span></i18n-format><div><div></div></div><!-- nested empty div -->
        <span id="whitespace"> &nbsp; </span>
        <h1><i18n-format lang="{{effectiveLang}}"><span>{{text.h1_3.0}}</span><span param="1">{{param1}}</span><span param="2">{{param2}}</span></i18n-format></h1><i18n-format lang="{{effectiveLang}}"><span>{{text.text_4.0}}</span><span param="1">{{param1}}</span><span param="2">{{param2}}</span></i18n-format><span><i18n-format lang="{{effectiveLang}}"><span>{{text.span_5.0}}</span><span param="1">{{param1}}</span><span param="2">{{param2}}</span></i18n-format></span>
        <span><i18n-format lang="{{effectiveLang}}"><span>{{text.span_6.0}}</span><span param="1">{{param1}}</span><span param="2">{{param2}}</span></i18n-format></span>
        <span id="label-1"><i18n-format lang="{{effectiveLang}}"><span>{{text.label-1.0}}</span><span param="1">{{param1}}</span><span param="2">{{param2}}</span></i18n-format></span>
        <span id="label-2"><i18n-format lang="{{effectiveLang}}"><span>{{text.label-2.0}}</span><span param="1">{{param1}}</span><span param="2">{{param2}}</span></i18n-format></span>
        <div>
          <span><i18n-format lang="{{effectiveLang}}"><span>{{text.div_9:span.0}}</span><span param="1">{{param1}}</span><span param="2">{{param2}}</span></i18n-format></span> 
          <span><i18n-format lang="{{effectiveLang}}"><span>{{text.div_9:span_1.0}}</span><span param="1">{{param1}}</span><span param="2">{{param2}}</span></i18n-format></span> 
          <div><div><i18n-format lang="{{effectiveLang}}"><span>{{text.div_9:div_2:div.0}}</span><span param="1">{{param1}}</span><span param="2">{{param2}}</span></i18n-format></div></div> 
        </div>
        <div><i18n-format lang="{{effectiveLang}}"><span>{{text.div_10:text.0}}</span><span param="1">{{param1}}</span><span param="2">{{param2}}</span></i18n-format><span><i18n-format lang="{{effectiveLang}}"><span>{{text.div_10:span_1.0}}</span><span param="1">{{param1}}</span><span param="2">{{param2}}</span></i18n-format></span><i18n-format lang="{{effectiveLang}}"><span>{{text.div_10:text_2.0}}</span><span param="1">{{param1}}</span><span param="2">{{param2}}</span></i18n-format><span><i18n-format lang="{{effectiveLang}}"><span>{{text.div_10:span_3.0}}</span><span param="1">{{param1}}</span><span param="2">{{param2}}</span></i18n-format></span>
          <div><div><i18n-format lang="{{effectiveLang}}"><span>{{text.div_10:div_4:div.0}}</span><span param="1">{{param1}}</span><span param="2">{{param2}}</span></i18n-format></div></div><i18n-format lang="{{effectiveLang}}"><span>{{text.div_10:text_5.0}}</span><span param="1">{{param1}}</span><span param="2">{{param2}}</span></i18n-format></div>
        <div id="toplevel-div">
          <span><i18n-format lang="{{effectiveLang}}"><span>{{text.toplevel-div:span.0}}</span><span param="1">{{param1}}</span><span param="2">{{param2}}</span></i18n-format></span>
          <span><i18n-format lang="{{effectiveLang}}"><span>{{text.toplevel-div:span_1.0}}</span><span param="1">{{param1}}</span><span param="2">{{param2}}</span></i18n-format></span>
          <div id="second-level-div">
            <div id="third-level-div"><i18n-format lang="{{effectiveLang}}"><span>{{text.third-level-div.0}}</span><span param="1">{{param1}}</span><span param="2">{{param2}}</span></i18n-format></div>
            <div><i18n-format lang="{{effectiveLang}}"><span>{{text.second-level-div:div_1.0}}</span><span param="1">{{param1}}</span><span param="2">{{param2}}</span></i18n-format></div>
          </div>
        </div>
        <div>
          <ul>
            <li><i18n-format lang="{{effectiveLang}}"><span>{{text.div_12:ul:li.0}}</span><span param="1">{{param1}}</span><span param="2">{{param2}}</span></i18n-format></li>
            <li><i18n-format lang="{{effectiveLang}}"><span>{{text.div_12:ul:li_1.0}}</span><span param="1">{{param1}}</span><span param="2">{{param2}}</span></i18n-format></li>
            <li><i18n-format lang="{{effectiveLang}}"><span>{{text.div_12:ul:li_2.0}}</span><span param="1">{{param1}}</span><span param="2">{{param2}}</span></i18n-format></li>
          </ul>
          <ul id="line-items">
            <li><i18n-format lang="{{effectiveLang}}"><span>{{text.line-items:li.0}}</span><span param="1">{{param1}}</span><span param="2">{{param2}}</span></i18n-format></li>
            <li><i18n-format lang="{{effectiveLang}}"><span>{{text.line-items:li_1.0}}</span><span param="1">{{param1}}</span><span param="2">{{param2}}</span></i18n-format></li>
            <li><i18n-format lang="{{effectiveLang}}"><span>{{text.line-items:li_2.0}}</span><span param="1">{{param1}}</span><span param="2">{{param2}}</span></i18n-format></li>
          </ul>
        </div>
        <p><i18n-format lang="{{effectiveLang}}"><span>{{text.p_13.0}}</span><span param="1">{{param1}}</span><span param="2">{{param2}}</span></i18n-format></p>
        <p id="paragraph"><i18n-format lang="{{effectiveLang}}"><span>{{text.paragraph.0}}</span><b param="1">{{text.paragraph.1}}</b><span param="2">{{param1}}</span><span param="3">{{param2}}</span><code param="4">{{text.paragraph.4}}</code></i18n-format></p><i18n-format lang="{{effectiveLang}}"><span>{{text.text_15.0}}</span><span param="1">{{param1}}</span><span param="2">{{param2}}</span></i18n-format><template id="localizable-text">
<json-data>
{
  "meta": {},
  "model": {},
  "text": [
    " outermost text at the beginning with compound {1} and {2} variables ",
    "{{param1}}",
    "{{param2}}"
  ],
  "h1_3": [
    "outermost header 1 with {1} and {2} variables",
    "{{param1}}",
    "{{param2}}"
  ],
  "text_4": [
    " outermost text in the middle with {1} and {2} variables ",
    "{{param1}}",
    "{{param2}}"
  ],
  "span_5": [
    "simple text without id with {1} and {2} variables",
    "{{param1}}",
    "{{param2}}"
  ],
  "span_6": [
    "simple text without id 2 with {1} and {2} variables",
    "{{param1}}",
    "{{param2}}"
  ],
  "label-1": [
    "simple text with id and {1} and {2} variables",
    "{{param1}}",
    "{{param2}}"
  ],
  "label-2": [
    "simple text with id and {1} and {2} variables 2",
    "{{param1}}",
    "{{param2}}"
  ],
  "div_9:span": [
    "simple text within div with {1} and {2} variables",
    "{{param1}}",
    "{{param2}}"
  ],
  "div_9:span_1": [
    "simple text within div with {1} and {2} variables 2",
    "{{param1}}",
    "{{param2}}"
  ],
  "div_9:div_2:div": [
    "great grandchild text within div with {1} and {2} variables",
    "{{param1}}",
    "{{param2}}"
  ],
  "div_10:text": [
    " simple text as the first element in div with {1} and {2} variables ",
    "{{param1}}",
    "{{param2}}"
  ],
  "div_10:span_1": [
    "simple text within div with {1} and {2} variables",
    "{{param1}}",
    "{{param2}}"
  ],
  "div_10:text_2": [
    " simple text in the middle of div with {1} and {2} variables ",
    "{{param1}}",
    "{{param2}}"
  ],
  "div_10:span_3": [
    "simple text within div with {1} and {2} variables 2",
    "{{param1}}",
    "{{param2}}"
  ],
  "div_10:div_4:div": [
    "great grandchild text within div with {1} and {2} variables",
    "{{param1}}",
    "{{param2}}"
  ],
  "div_10:text_5": [
    " simple text at the last element in div with {1} and {2} variables ",
    "{{param1}}",
    "{{param2}}"
  ],
  "toplevel-div:span": [
    "simple text within div with {1} and {2} variables",
    "{{param1}}",
    "{{param2}}"
  ],
  "toplevel-div:span_1": [
    "simple text within div 2 with {1} and {2} variables",
    "{{param1}}",
    "{{param2}}"
  ],
  "third-level-div": [
    "great grandchild text within div with {1} and {2} variables",
    "{{param1}}",
    "{{param2}}"
  ],
  "second-level-div:div_1": [
    "great grandchild text within div without id with {1} and {2} variables",
    "{{param1}}",
    "{{param2}}"
  ],
  "div_12:ul:li": [
    "line item without id 1 with {1} and {2} variables",
    "{{param1}}",
    "{{param2}}"
  ],
  "div_12:ul:li_1": [
    "line item without id 2 with {1} and {2} variables",
    "{{param1}}",
    "{{param2}}"
  ],
  "div_12:ul:li_2": [
    "line item without id 3 with {1} and {2} variables",
    "{{param1}}",
    "{{param2}}"
  ],
  "line-items:li": [
    "line item with id 1 with {1} and {2} variables",
    "{{param1}}",
    "{{param2}}"
  ],
  "line-items:li_1": [
    "line item with id 2 with {1} and {2} variables",
    "{{param1}}",
    "{{param2}}"
  ],
  "line-items:li_2": [
    "line item with id 3 with {1} and {2} variables",
    "{{param1}}",
    "{{param2}}"
  ],
  "p_13": [
    "A paragraph with {1} is converted to {2}.",
    "{{param1}}",
    "{{param2}}"
  ],
  "paragraph": [
    "A paragraph with {1}, {2}, and {3} is converted to {4}.",
    "id",
    "{{param1}}",
    "{{param2}}",
    "&lt;i18n-format&gt;"
  ],
  "text_15": [
    " outermost text at the end with {1} and {2} variables ",
    "{{param1}}",
    "{{param2}}"
  ]
}
</json-data>
</template>
</template>
    </div>

<!--
    <test-fixture id="static">
      <template>
        <i18n-format lang="en">
          <span>Parameter {1} and {2} are rendered.</span>
          <b>A</b>
          <i>B</i>
        </i18n-format>
      </template>
    </test-fixture>

    <test-fixture id="non-default-attributes">
      <template>
        <i18n-format lang="fr" param-attribute="parameter" param-format="%n%">
          <span>Parameter %1% and %2% are rendered.</span>
          <b>A</b>
          <i>B</i>
        </i18n-format>
      </template>
    </test-fixture>

    <test-fixture id="bound">
      <template is="dom-template" id="bound-template">
        <i18n-format lang="{{lang}}">
          <span>{{text.0}}</span>
          <b>{{text.1}}</b>
          <i>{{text.2}}</i>
        </i18n-format>
      </template>
    </test-fixture>

    <test-fixture id="compound-static">
      <template>
        <i18n-format lang="en">
          <json-data>{
            "0": "You ({3}) gave no gifts.",
            "1": {
              "male": "You ({3}) gave him ({4}) {5}.",
              "female": "You ({3}) gave her ({4}) {5}.",
              "other": "You ({3}) gave them ({4}) {5}."
            },
            "one": {
              "male": "You ({3}) gave him ({4}) and one other person {5}.",
              "female": "You ({3}) gave her ({4}) and one other person {5}.",
              "other": "You ({3}) gave them ({4}) and one other person {5}."
            },
            "other": "You ({3}) gave them ({4}) and {1} other people gifts."
          }</json-data>
          <i18n-number lang="en" offset="1">2</i18n-number>
          <span>female</span>
          <span>Joe</span>
          <span>Alice</span>
          <span>a gift</span>
        </i18n-format>
      </template>
    </test-fixture>

    <test-fixture id="bound-and-wrapped">
      <template is="dom-template" id="bound-and-wrapped-template">
        <bound-i18n-format 
          lang="{{lang}}"
          text="{{text}}"
          param-format="{{paramFormat}}"
          compound-text="{{compoundText}}"
          recipients="{{recipients}}"
          sender="{{sender}}"></bound-i18n-format>
      </template>
    </test-fixture>
-->
    <script>
suite('I18nBehavior with ' + 
  (window.location.href.indexOf('?dom=Shadow') >= 0 ? 'Shadow DOM' : 'Shady DOM'), 
  function () {

/*
  suite('default values', function () {
    var el;

    setup(function () {
      el = fixture('default');
    });

    test('default lang property', function () {
      assert.equal(el.lang, 'en', 'default lang is en');
    });

    test('DEFAULT_LANG property', function () {
      assert.equal(el.DEFAULT_LANG, 'en', 'DEFAULT_LANG is en');
    });

    test('default paramAttribute property', function () {
      assert.equal(el.paramAttribute, 'param', 'default paramAttribute is param');
    });

    test('default paramFormat property', function () {
      assert.equal(el.paramFormat, '{n}', 'default paramFormat is {n}');
    });

    test('default observeParams property', function () {
      assert.isBoolean(el.observeParams, 'observeParams is a Boolean');
      assert.equal(el.observeParams, true, 'default observeParams is true');
    });

    test('default textContent is empty', function () {
      assert.equal(Polymer.dom(el.root).textContent, '', 'textContent is empty');
    });

  });
*/

  if (!Number.isNaN) {
    // polyfill Number.isNaN for IE11
    Number.isNaN = function (value) {
      return typeof value === 'number' && isNaN(value);
    };
  }
  var lang0 = '';
  var lang1 = 'en';
  var lang2 = 'fr';
  var lang3 = 'ja';
  var lang4 = 'fr-CA';
  var lang5 = 'zh-Hans-CN';
  var text_simple = {
    'model': {},
    'text': ' outermost text at the beginning ',
    'h1_3': 'outermost header 1',
    'text_4': ' outermost text in the middle ',
    'span_5': 'simple text without id',
    'span_6': 'simple text without id 2',
    'label-1': 'simple text with id',
    'label-2': 'simple text with id 2',
    'div_9:span': 'simple text within div',
    'div_9:span_1': 'simple text within div 2',
    'div_9:div_2:div': 'great grandchild text within div',
    'div_10:text': ' simple text as the first element in div ',
    'div_10:span_1': 'simple text within div',
    'div_10:text_2': ' simple text in the middle of div ',
    'div_10:span_3': 'simple text within div 2',
    'div_10:div_4:div': 'great grandchild text within div',
    'div_10:text_5': ' simple text at the last element in div ',
    'toplevel-div:span': 'simple text within div',
    'toplevel-div:span_1': 'simple text within div 2',
    'third-level-div': 'great grandchild text within div',
    'second-level-div:div_1': 'great grandchild text within div without id',
    'div_12:ul:li': 'line item without id 1',
    'div_12:ul:li_1': 'line item without id 2',
    'div_12:ul:li_2': 'line item without id 3',
    'line-items:li': 'line item with id 1',
    'line-items:li_1': 'line item with id 2',
    'line-items:li_2': 'line item with id 3',
    'p_13': [
      'A paragraph with {1} is converted to {2}.',
      'parameters',
      '<i18n-format>'
    ],
    'paragraph': [
      'A paragraph with {1} is converted to {2}.',
      'id',
      '<i18n-format>'
    ],
    'text_15': ' outermost text at the end '
  };
  var localDOM_simple = [
    { select: 'div:not([id])', 'previousTextSibling.data': ' outermost text at the beginning ' },
    { select: 'h1', textContent: 'outermost header 1' },
    { select: 'h1', 'nextTextSibling.data': ' outermost text in the middle ' },
    { select: 'span:not([id])', textContent: [ 'simple text without id', 'simple text without id 2' ] },
    { select: 'span[id="label-1"]', textContent: 'simple text with id' },
    { select: 'span[id="label-2"]', textContent: 'simple text with id 2' },
    { select: 'span[id="label-2"] + div span:not([id])', textContent:  [ 'simple text within div', 'simple text within div 2' ] },
    { select: 'span[id="label-2"] + div div:not([id]) div:not([id])', textContent: [ 'great grandchild text within div' ] },
    { select: 'span[id="label-2"] + div + div', 'childNodes.0.data': ' simple text as the first element in div ' },
    { select: 'span[id="label-2"] + div + div span:not([id])', textContent:  [ 'simple text within div', 'simple text within div 2' ] },
    { select: 'span[id="label-2"] + div + div span:not([id])', 'nextTextSibling.data': ' simple text in the middle of div ' },
    { select: 'span[id="label-2"] + div + div div:not([id]) div:not([id])', textContent: 'great grandchild text within div' },
    { select: 'span[id="label-2"] + div + div div:not([id])', 'nextTextSibling.data': ' simple text at the last element in div ' },
    { select: '[id="toplevel-div"] span:not([id])', textContent: [ 'simple text within div', 'simple text within div 2' ] },
    { select: '[id="third-level-div"]', textContent: 'great grandchild text within div' },
    { select: '[id="second-level-div"] div:not([id])', textContent: 'great grandchild text within div without id' },
    { select: 'div ul:not([id]) li:not([id])', textContent: [ 'line item without id 1', 'line item without id 2', 'line item without id 3' ] },
    { select: '[id="line-items"] li:not([id])', textContent: [ 'line item with id 1', 'line item with id 2', 'line item with id 3' ] },
    { select: 'p:not([id]) i18n-format', 
      'PolymerDom.children.0.textContent': 'A paragraph with {1} is converted to {2}.' },
    { select: 'p:not([id]) i18n-format',
      'PolymerDom.children.1.tagName': 'B',
      'PolymerDom.children.1.textContent': 'parameters',
      'PolymerDom.children.1.attributes.param.value': '1' },
    { select: 'p:not([id]) i18n-format',
      'PolymerDom.children.2.tagName': 'CODE',
      'PolymerDom.children.2.textContent': '<i18n-format>',
      'PolymerDom.children.2.attributes.param.value': '2' },
    { select: '[id="paragraph"] i18n-format',
      'PolymerDom.children.0.textContent': 'A paragraph with {1} is converted to {2}.' },
    { select: '[id="paragraph"] i18n-format',
      'PolymerDom.children.1.tagName': 'B',
      'PolymerDom.children.1.textContent': 'id',
      'PolymerDom.children.1.attributes.param.value': '1' },
    { select: '[id="paragraph"] i18n-format',
      'PolymerDom.children.2.tagName': 'CODE',
      'PolymerDom.children.2.textContent': '<i18n-format>',
      'PolymerDom.children.2.attributes.param.value': '2' },
    { select: '[id="paragraph"]', 'nextTextSibling.data': ' outermost text at the end ' }
  ];
  var text_simple_text_id = {
    'model': {},
    'text': ' outermost text at the beginning ',
    'h1_3': 'outermost header 1',
    'text_4': ' outermost text in the middle ',
    'span_5': 'simple text without id',
    'span_6': 'simple text without id 2',
    'label-1': 'simple text with id',
    'label-2': 'simple text with id 2',
    'div_9:span': 'simple text within div',
    'div_9:span_1': 'simple text within div 2',
    'div_9:div_2:div': 'great grandchild text within div',
    'div_10:text': ' simple text as the first element in div ',
    'div_10:span_1': 'simple text within div',
    'div_10:text_2': ' simple text in the middle of div ',
    'div_10:span_3': 'simple text within div 2',
    'div_10:div_4:div': 'great grandchild text within div',
    'div_10:text_5': ' simple text at the last element in div ',
    'toplevel-div:span': 'simple text within div',
    'toplevel-div:span_1': 'simple text within div 2',
    'second-level-div': [
      ' {1}\n        {2} ',
      'great grandchild text within div',
      'great grandchild text within div without id'
    ],
    'div_12:ul:li': 'line item without id 1',
    'div_12:ul:li_1': 'line item without id 2',
    'div_12:ul:li_2': 'line item without id 3',
    'line-items': [
      ' {1}\n        {2}\n        {3} ',
      'line item with id 1',
      'line item with id 2',
      'line item with id 3'
    ],
    'p_13': [
      'A paragraph with {1} is converted to {2}.',
      'parameters',
      '<i18n-format>'
    ],
    'paragraph': [
      'A paragraph with {1} is converted to {2}.',
      'id',
      '<i18n-format>'
    ],
    'text_15': ' outermost text at the end '
  };
  var localDOM_simple_text_id = [
    { select: 'div:not([text-id])', 'previousTextSibling.data': ' outermost text at the beginning ' },
    { select: 'h1', textContent: 'outermost header 1' },
    { select: 'h1', 'nextTextSibling.data': ' outermost text in the middle ' },
    { select: 'span:not([text-id])', textContent: [ 'simple text without id', 'simple text without id 2' ] },
    { select: 'span[text-id="label-1"]', textContent: 'simple text with id' },
    { select: 'span[text-id="label-2"]', textContent: 'simple text with id 2' },
    { select: 'span[text-id="label-2"] + div span:not([text-id])', textContent:  [ 'simple text within div', 'simple text within div 2' ] },
    { select: 'span[text-id="label-2"] + div div:not([text-id]) div:not([text-id])', textContent: [ 'great grandchild text within div' ] },
    { select: 'span[text-id="label-2"] + div + div', 'childNodes.0.data': ' simple text as the first element in div ' },
    { select: 'span[text-id="label-2"] + div + div span:not([text-id])', textContent:  [ 'simple text within div', 'simple text within div 2' ] },
    { select: 'span[text-id="label-2"] + div + div span:not([text-id])', 'nextTextSibling.data': ' simple text in the middle of div ' },
    { select: 'span[text-id="label-2"] + div + div div:not([text-id]) div:not([text-id])', textContent: 'great grandchild text within div' },
    { select: 'span[text-id="label-2"] + div + div div:not([text-id])', 'nextTextSibling.data': ' simple text at the last element in div ' },
    { select: '[text-id="toplevel-div"] span:not([text-id])', textContent: [ 'simple text within div', 'simple text within div 2' ] },
    { select: '[text-id="second-level-div"] i18n-format',
      'PolymerDom.children.0.textContent': ' {1}\n        {2} ' },
    { select: '[text-id="second-level-div"] i18n-format',
      'PolymerDom.children.1.tagName': 'DIV',
      'PolymerDom.children.1.textContent': 'great grandchild text within div',
      'PolymerDom.children.1.attributes.param.value': '1' },
    { select: '[text-id="second-level-div"] i18n-format',
      'PolymerDom.children.2.tagName': 'DIV',
      'PolymerDom.children.2.textContent': 'great grandchild text within div without id',
      'PolymerDom.children.2.attributes.param.value': '2' },
    { select: 'div ul:not([text-id]) li:not([text-id])', textContent: [ 'line item without id 1', 'line item without id 2', 'line item without id 3' ] },
    { select: '[text-id="line-items"] i18n-format',
      'PolymerDom.children.0.textContent': ' {1}\n        {2}\n        {3} ' },
    { select: '[text-id="line-items"] i18n-format',
      'PolymerDom.children.1.tagName': 'LI',
      'PolymerDom.children.1.textContent': 'line item with id 1',
      'PolymerDom.children.1.attributes.param.value': '1' },
    { select: '[text-id="line-items"] i18n-format',
      'PolymerDom.children.2.tagName': 'LI',
      'PolymerDom.children.2.textContent': 'line item with id 2',
      'PolymerDom.children.2.attributes.param.value': '2' },
    { select: '[text-id="line-items"] i18n-format',
      'PolymerDom.children.3.tagName': 'LI',
      'PolymerDom.children.3.textContent': 'line item with id 3',
      'PolymerDom.children.3.attributes.param.value': '3' },
    { select: 'p:not([text-id]) i18n-format', 
      'PolymerDom.children.0.textContent': 'A paragraph with {1} is converted to {2}.' },
    { select: 'p:not([text-id]) i18n-format',
      'PolymerDom.children.1.tagName': 'B',
      'PolymerDom.children.1.textContent': 'parameters',
      'PolymerDom.children.1.attributes.param.value': '1' },
    { select: 'p:not([text-id]) i18n-format',
      'PolymerDom.children.2.tagName': 'CODE',
      'PolymerDom.children.2.textContent': '<i18n-format>',
      'PolymerDom.children.2.attributes.param.value': '2' },
    { select: '[text-id="paragraph"] i18n-format',
      'PolymerDom.children.0.textContent': 'A paragraph with {1} is converted to {2}.' },
    { select: '[text-id="paragraph"] i18n-format',
      'PolymerDom.children.1.tagName': 'B',
      'PolymerDom.children.1.textContent': 'id',
      'PolymerDom.children.1.attributes.param.value': '1' },
    { select: '[text-id="paragraph"] i18n-format',
      'PolymerDom.children.2.tagName': 'CODE',
      'PolymerDom.children.2.textContent': '<i18n-format>',
      'PolymerDom.children.2.attributes.param.value': '2' },
    { select: '[text-id="paragraph"]', 'nextTextSibling.data': ' outermost text at the end ' }
  ];
  var sender1 = {
    'name': 'Joe',
    'gender': 'male'
  };
  var recipients1 = [
    { 'name': 'Alice', 'gender': 'female' },
    { 'name': 'Bob', 'gender': 'male' },
    { 'name': 'Yoda', 'gender': 'other' }
  ];
  var recipients2 = [
    { 'name': 'Alice', 'gender': 'female' },
    { 'name': 'Bob', 'gender': 'male' }
  ];
  var recipients3 = [
    { 'name': 'Bob', 'gender': 'male' }
  ];
  var recipients4 = [];
  var text_plural_gender = {
    'model': {},
    'compound-format-text': [
      {
        '0': 'You ({3}) gave no gifts.',
        '1': {
          'male': 'You ({3}) gave him ({4}) {5}.',
          'female': 'You ({3}) gave her ({4}) {5}.',
          'other': 'You ({3}) gave them ({4}) {5}.'
        },
        'one': {
          'male': 'You ({3}) gave him ({4}) and one other person {5}.',
          'female': 'You ({3}) gave her ({4}) and one other person {5}.',
          'other': 'You ({3}) gave them ({4}) and one other person {5}.'
        },
        'other': 'You ({3}) gave them ({4}) and {1} other people gifts.'
      },
      '{{recipients.length - 1}}',
      '{{recipients.0.gender}}',
      '{{sender.name}}',
      '{{recipients.0.name}}',
      'a gift'
    ]
  };
  var localDOM_plural_gender_1 = [
    { select: '#compound-format-text', 'root.PolymerDom.textContent': 'You () gave them () and  other people gifts.' },
    { select: '#compound-format-text', 'PolymerDom.children.1.PolymerDom.childNodes.0.data.raw': '3' },
    { select: '#compound-format-text', 'PolymerDom.children.2.PolymerDom.childNodes.0.data.raw': 'female' },
    { select: '#compound-format-text', 'PolymerDom.children.3.PolymerDom.childNodes.0.data.raw': 'Joe' },
    { select: '#compound-format-text', 'PolymerDom.children.4.PolymerDom.childNodes.0.data.raw': 'Alice' },
    { select: '#compound-format-text', 'PolymerDom.children.5.PolymerDom.childNodes.0.data': 'a gift' }
  ];
  var localDOM_plural_gender_2 = [
    { select: '#compound-format-text', 'root.PolymerDom.textContent': 'You () gave her () and one other person .' },
    { select: '#compound-format-text', 'PolymerDom.children.1.PolymerDom.childNodes.0.data.raw': '2' },
    { select: '#compound-format-text', 'PolymerDom.children.2.PolymerDom.childNodes.0.data.raw': 'female' },
    { select: '#compound-format-text', 'PolymerDom.children.3.PolymerDom.childNodes.0.data.raw': 'Joe' },
    { select: '#compound-format-text', 'PolymerDom.children.4.PolymerDom.childNodes.0.data.raw': 'Alice' },
    { select: '#compound-format-text', 'PolymerDom.children.5.PolymerDom.childNodes.0.data': 'a gift' }
  ];
  var localDOM_plural_gender_3 = [
    { select: '#compound-format-text', 'root.PolymerDom.textContent': 'You () gave him () .' },
    { select: '#compound-format-text', 'PolymerDom.children.1.PolymerDom.childNodes.0.data.raw': '1' },
    { select: '#compound-format-text', 'PolymerDom.children.2.PolymerDom.childNodes.0.data.raw': 'male' },
    { select: '#compound-format-text', 'PolymerDom.children.3.PolymerDom.childNodes.0.data.raw': 'Joe' },
    { select: '#compound-format-text', 'PolymerDom.children.4.PolymerDom.childNodes.0.data.raw': 'Bob' },
    { select: '#compound-format-text', 'PolymerDom.children.5.PolymerDom.childNodes.0.data': 'a gift' }
  ];
  var localDOM_plural_gender_4 = [
    { select: '#compound-format-text', 'root.PolymerDom.textContent': 'You () gave no gifts.' },
    { select: '#compound-format-text', 'PolymerDom.children.1.PolymerDom.childNodes.0.data.raw': '0' },
    { select: '#compound-format-text', 'PolymerDom.children.2.PolymerDom.childNodes.0.data.raw': '' },
    { select: '#compound-format-text', 'PolymerDom.children.3.PolymerDom.childNodes.0.data.raw': 'Joe' },
    { select: '#compound-format-text', 'PolymerDom.children.4.PolymerDom.childNodes.0.data.raw': '' },
    { select: '#compound-format-text', 'PolymerDom.children.5.PolymerDom.childNodes.0.data': 'a gift' }
  ];
  var text_simple_attribute = {
    'model': {
      'standard-input': {
        'placeholder': 'standard HTML5 attribute'
      },
      'outer-div:input_2': {
        'placeholder': 'standard HTML5 attribute without id'
      },
      'paper-input-element': {
        'label': 'paper-input label',
        'error-message': 'paper-input error message',
        'placeholder': 'paper-input placeholder'
      },
      'outer-div:paper-input_4': {
        'label': 'paper-input label without id',
        'error-message': 'paper-input error message without id',
        'placeholder': 'paper-input placeholder without id'
      },
      'pie-chart': {
        'options': {
          'title': 'Distribution of days in 2001H1'
        },
        'cols': [
          {
            'label': 'Month',
            'type': 'string'
          },
          {
            'label': 'Days',
            'type': 'number'
          }
        ],
        'rows': [
          [
            'Jan',
            31
          ],
          [
            'Feb',
            28
          ],
          [
            'Mar',
            31
          ],
          [
            'Apr',
            30
          ],
          [
            'May',
            31
          ],
          [
            'Jun',
            30
          ]
        ]
      },
      'column-chart': {
        'options': {
          'title': 'Inventory'
        },
        'data': [
          [
            'Year',
            'Things',
            'Stuff'
          ],
          [
            '2004',
            1000,
            400
          ],
          [
            '2005',
            1170,
            460
          ],
          [
            '2006',
            660,
            1120
          ],
          [
            '2007',
            1030,
            540
          ]
        ]
      },
      'custom-attr': {
        'custom-text-attr1': 'custom text attribute 1',
        'custom-text-attr2': 'custom text attribute 2',
        'custom-text-attr3': 'custom text attribute 3'
      },
      'json-data-id': {
        'attr1': 'this attr1 is extracted',
        'i18n-target-attr': 'this attribute is also extracted'
      },
      'template_2:json-data_1': {
        'attr1': 'this attr1 without id is extracted',
        'i18n-target-attr': 'this attribute without id is also extracted'
      }
    },
    'ordinary-div': 'text 1'
  };
  var model_simple_attribute = {
    'standard-input': {
      'placeholder': 'standard HTML5 attribute'
    },
    'outer-div:input_2': {
      'placeholder': 'standard HTML5 attribute without id'
    },
    'paper-input-element': {
      'label': 'paper-input label',
      'error-message': 'paper-input error message',
      'placeholder': 'paper-input placeholder'
    },
    'outer-div:paper-input_4': {
      'label': 'paper-input label without id',
      'error-message': 'paper-input error message without id',
      'placeholder': 'paper-input placeholder without id'
    },
    'pie-chart': {
      'options': {
        'title': 'Distribution of days in 2001H1'
      },
      'cols': [
        {
          'label': 'Month',
          'type': 'string'
        },
        {
          'label': 'Days',
          'type': 'number'
        }
      ],
      'rows': [
        [
          'Jan',
          31
        ],
        [
          'Feb',
          28
        ],
        [
          'Mar',
          31
        ],
        [
          'Apr',
          30
        ],
        [
          'May',
          31
        ],
        [
          'Jun',
          30
        ]
      ]
    },
    'column-chart': {
      'options': {
        'title': 'Inventory'
      },
      'data': [
        [
          'Year',
          'Things',
          'Stuff'
        ],
        [
          '2004',
          1000,
          400
        ],
        [
          '2005',
          1170,
          460
        ],
        [
          '2006',
          660,
          1120
        ],
        [
          '2007',
          1030,
          540
        ]
      ]
    },
    'custom-attr': {
      'custom-text-attr1': 'custom text attribute 1',
      'custom-text-attr2': 'custom text attribute 2',
      'custom-text-attr3': 'custom text attribute 3'
    },
    'json-data-id': {
      'attr1': 'this attr1 is extracted',
      'i18n-target-attr': 'this attribute is also extracted'
    },
    'template_2:json-data_1': {
      'attr1': 'this attr1 without id is extracted',
      'i18n-target-attr': 'this attribute without id is also extracted'
    }
  };
  var localDOM_simple_attribute = [
    { select: 'input[id="standard-input"]', 'placeholder.text': 'standard HTML5 attribute' },
    { select: 'input[id="standard-input"] + input', 'placeholder.text': 'standard HTML5 attribute without id' },
    { select: 'paper-input[id="paper-input-element"]', 'label.text': 'paper-input label', 'errorMessage.text': 'paper-input error message', 'placeholder.text': 'paper-input placeholder' },
    { select: 'paper-input[id="paper-input-element"] + paper-input', 'label.text': 'paper-input label without id', 'errorMessage.text': 'paper-input error message without id', 'placeholder.text': 'paper-input placeholder without id' },
    { select: 'google-chart[id="pie-chart"]', 'options.title.text': 'Distribution of days in 2001H1', 'cols.0.label.text': 'Month', 'cols.1.label.text': 'Days', 'rows.0.0.text': 'Jan', 'rows.1.0.text': 'Feb', 'rows.2.0.text': 'Mar', 'rows.3.0.text': 'Apr', 'rows.4.0.text': 'May', 'rows.5.0.text': 'Jun' },
    { select: 'google-chart[id="column-chart"]', 'options.title.text': 'Inventory', 'data.0.0.text': 'Year', 'data.0.1.text': 'Things', 'data.0.2.text': 'Stuff' },
    { select: 'text-attribute-element[id="custom-attr"]', 'customTextAttr1.text': 'custom text attribute 1', 'customTextAttr2.text': 'custom text attribute 2', 'customTextAttr3.text': 'custom text attribute 3' },
    { select: 'span[id="test-json-data-1"]', 'textContent': 'this attr1 is extracted' },
    { select: 'span[id="test-json-data-2"]', 'textContent': 'this attribute is also extracted' },
    { select: 'span[id="test-json-data-3"]', 'textContent': 'this attr1 without id is extracted' },
    { select: 'span[id="test-json-data-4"]', 'textContent': 'this attribute without id is also extracted' },
  ];
  var text_fallback = {
    'model': {},
    'text': 'fr-CA  outermost text at the beginning ',
    'h1_3': 'fr-CA outermost header 1',
    'text_4': 'fr-CA  outermost text in the middle ',
    'span_5': 'fr-CA simple text without id',
    'span_6': 'fr-CA simple text without id 2',
    'label-1': 'fr-CA simple text with id',
    'label-2': 'fr-CA simple text with id 2',
    'div_9:span': 'simple text within div',
    'div_9:span_1': 'simple text within div 2',
    'div_9:div_2:div': 'great grandchild text within div',
    'div_10:text': ' simple text as the first element in div ',
    'div_10:span_1': 'fr-CA simple text within div',
    'div_10:text_2': ' simple text in the middle of div ',
    'div_10:span_3': 'simple text within div 2',
    'div_10:div_4:div': 'great grandchild text within div',
    'div_10:text_5': ' simple text at the last element in div ',
    'toplevel-div:span': 'fr-CA simple text within div',
    'toplevel-div:span_1': 'fr-CA simple text within div 2',
    'third-level-div': 'fr-CA great grandchild text within div',
    'second-level-div:div_1': 'fr-CA great grandchild text within div without id',
    'div_12:ul:li': 'fr line item without id 1',
    'div_12:ul:li_1': 'fr line item without id 2',
    'div_12:ul:li_2': 'fr line item without id 3',
    'line-items:li': 'fr line item with id 1',
    'line-items:li_1': 'fr line item with id 2',
    'line-items:li_2': 'fr line item with id 3',
    'p_13': [
      'fr-CA A paragraph with {1} is converted to {2}.',
      'fr-CA parameters',
      'fr-CA <i18n-format>'
    ],
    'paragraph': [
      'fr-CA A paragraph with {1} is converted to {2}.',
      'fr-CA id',
      'fr-CA <i18n-format>'
    ],
    'text_15': 'fr-CA  outermost text at the end '
  };
  var localDOM_fallback = [
    { select: 'div:not([id])', 'previousTextSibling.data': 'fr-CA  outermost text at the beginning ' },
    { select: 'h1', textContent: 'fr-CA outermost header 1' },
    { select: 'h1', 'nextTextSibling.data': 'fr-CA  outermost text in the middle ' },
    { select: 'span:not([id])', textContent: [ 'fr-CA simple text without id', 'fr-CA simple text without id 2' ] },
    { select: 'span[id="label-1"]', textContent: 'fr-CA simple text with id' },
    { select: 'span[id="label-2"]', textContent: 'fr-CA simple text with id 2' },
    { select: 'span[id="label-2"] + div span:not([id])', textContent:  [ 'simple text within div', 'simple text within div 2' ] },
    { select: 'span[id="label-2"] + div div:not([id]) div:not([id])', textContent: [ 'great grandchild text within div' ] },
    { select: 'span[id="label-2"] + div + div', 'childNodes.0.data': ' simple text as the first element in div ' },
    { select: 'span[id="label-2"] + div + div span:not([id])', textContent:  [ 'fr-CA simple text within div', 'simple text within div 2' ] },
    { select: 'span[id="label-2"] + div + div span:not([id])', 'nextTextSibling.data': ' simple text in the middle of div ' },
    { select: 'span[id="label-2"] + div + div div:not([id]) div:not([id])', textContent: 'great grandchild text within div' },
    { select: 'span[id="label-2"] + div + div div:not([id])', 'nextTextSibling.data': ' simple text at the last element in div ' },
    { select: '[id="toplevel-div"] span:not([id])', textContent: [ 'fr-CA simple text within div', 'fr-CA simple text within div 2' ] },
    { select: '[id="third-level-div"]', textContent: 'fr-CA great grandchild text within div' },
    { select: '[id="second-level-div"] div:not([id])', textContent: 'fr-CA great grandchild text within div without id' },
    { select: 'div ul:not([id]) li:not([id])', textContent: [ 'fr line item without id 1', 'fr line item without id 2', 'fr line item without id 3' ] },
    { select: '[id="line-items"] li:not([id])', textContent: [ 'fr line item with id 1', 'fr line item with id 2', 'fr line item with id 3' ] },
    { select: 'p:not([id]) i18n-format', 
      'PolymerDom.children.0.textContent': 'fr-CA A paragraph with {1} is converted to {2}.' },
    { select: 'p:not([id]) i18n-format',
      'PolymerDom.children.1.tagName': 'B',
      'PolymerDom.children.1.textContent': 'fr-CA parameters',
      'PolymerDom.children.1.attributes.param.value': '1' },
    { select: 'p:not([id]) i18n-format',
      'PolymerDom.children.2.tagName': 'CODE',
      'PolymerDom.children.2.textContent': 'fr-CA <i18n-format>',
      'PolymerDom.children.2.attributes.param.value': '2' },
    { select: '[id="paragraph"] i18n-format',
      'PolymerDom.children.0.textContent': 'fr-CA A paragraph with {1} is converted to {2}.' },
    { select: '[id="paragraph"] i18n-format',
      'PolymerDom.children.1.tagName': 'B',
      'PolymerDom.children.1.textContent': 'fr-CA id',
      'PolymerDom.children.1.attributes.param.value': '1' },
    { select: '[id="paragraph"] i18n-format',
      'PolymerDom.children.2.tagName': 'CODE',
      'PolymerDom.children.2.textContent': 'fr-CA <i18n-format>',
      'PolymerDom.children.2.attributes.param.value': '2' },
    { select: '[id="paragraph"]', 'nextTextSibling.data': 'fr-CA  outermost text at the end ' }
  ];
  var param1 = '1st compound parameter';
  var param2 = '2nd compound parameter';
  var text_compound = {
    'model': {},
    'text': [
      ' outermost text at the beginning with compound {1} and {2} variables ',
      '{{param1}}',
      '{{param2}}'
    ],
    'h1_3': [
      'outermost header 1 with {1} and {2} variables',
      '{{param1}}',
      '{{param2}}'
    ],
    'text_4': [
      ' outermost text in the middle with {1} and {2} variables ',
      '{{param1}}',
      '{{param2}}'
    ],
    'span_5': [
      'simple text without id with {1} and {2} variables',
      '{{param1}}',
      '{{param2}}'
    ],
    'span_6': [
      'simple text without id 2 with {1} and {2} variables',
      '{{param1}}',
      '{{param2}}'
    ],
    'label-1': [
      'simple text with id and {1} and {2} variables',
      '{{param1}}',
      '{{param2}}'
    ],
    'label-2': [
      'simple text with id and {1} and {2} variables 2',
      '{{param1}}',
      '{{param2}}'
    ],
    'div_9:span': [
      'simple text within div with {1} and {2} variables',
      '{{param1}}',
      '{{param2}}'
    ],
    'div_9:span_1': [
      'simple text within div with {1} and {2} variables 2',
      '{{param1}}',
      '{{param2}}'
    ],
    'div_9:div_2:div': [
      'great grandchild text within div with {1} and {2} variables',
      '{{param1}}',
      '{{param2}}'
    ],
    'div_10:text': [
      ' simple text as the first element in div with {1} and {2} variables ',
      '{{param1}}',
      '{{param2}}'
    ],
    'div_10:span_1': [
      'simple text within div with {1} and {2} variables',
      '{{param1}}',
      '{{param2}}'
    ],
    'div_10:text_2': [
      ' simple text in the middle of div with {1} and {2} variables ',
      '{{param1}}',
      '{{param2}}'
    ],
    'div_10:span_3': [
      'simple text within div with {1} and {2} variables 2',
      '{{param1}}',
      '{{param2}}'
    ],
    'div_10:div_4:div': [
      'great grandchild text within div with {1} and {2} variables',
      '{{param1}}',
      '{{param2}}'
    ],
    'div_10:text_5': [
      ' simple text at the last element in div with {1} and {2} variables ',
      '{{param1}}',
      '{{param2}}'
    ],
    'toplevel-div:span': [
      'simple text within div with {1} and {2} variables',
      '{{param1}}',
      '{{param2}}'
    ],
    'toplevel-div:span_1': [
      'simple text within div 2 with {1} and {2} variables',
      '{{param1}}',
      '{{param2}}'
    ],
    'third-level-div': [
      'great grandchild text within div with {1} and {2} variables',
      '{{param1}}',
      '{{param2}}'
    ],
    'second-level-div:div_1': [
      'great grandchild text within div without id with {1} and {2} variables',
      '{{param1}}',
      '{{param2}}'
    ],
    'div_12:ul:li': [
      'line item without id 1 with {1} and {2} variables',
      '{{param1}}',
      '{{param2}}'
    ],
    'div_12:ul:li_1': [
      'line item without id 2 with {1} and {2} variables',
      '{{param1}}',
      '{{param2}}'
    ],
    'div_12:ul:li_2': [
      'line item without id 3 with {1} and {2} variables',
      '{{param1}}',
      '{{param2}}'
    ],
    'line-items:li': [
      'line item with id 1 with {1} and {2} variables',
      '{{param1}}',
      '{{param2}}'
    ],
    'line-items:li_1': [
      'line item with id 2 with {1} and {2} variables',
      '{{param1}}',
      '{{param2}}'
    ],
    'line-items:li_2': [
      'line item with id 3 with {1} and {2} variables',
      '{{param1}}',
      '{{param2}}'
    ],
    'p_13': [
      'A paragraph with {1} is converted to {2}.',
      '{{param1}}',
      '{{param2}}'
    ],
    'paragraph': [
      'A paragraph with {1}, {2}, and {3} is converted to {4}.',
      'id',
      '{{param1}}',
      '{{param2}}',
      '<i18n-format>'
    ],
    'text_15': [
      ' outermost text at the end with {1} and {2} variables ',
      '{{param1}}',
      '{{param2}}'
    ]
  };
  var localDOM_compound = [
    { select: 'i18n-format', 
      'PolymerDom.children.0.textContent': [
        ' outermost text at the beginning with compound {1} and {2} variables ',
        'outermost header 1 with {1} and {2} variables',
        ' outermost text in the middle with {1} and {2} variables ',
        'simple text without id with {1} and {2} variables',
        'simple text without id 2 with {1} and {2} variables',
        'simple text with id and {1} and {2} variables',
        'simple text with id and {1} and {2} variables 2',
        'simple text within div with {1} and {2} variables',
        'simple text within div with {1} and {2} variables 2',
        'great grandchild text within div with {1} and {2} variables',
        ' simple text as the first element in div with {1} and {2} variables ',
        'simple text within div with {1} and {2} variables',
        ' simple text in the middle of div with {1} and {2} variables ',
        'simple text within div with {1} and {2} variables 2',
        'great grandchild text within div with {1} and {2} variables',
        ' simple text at the last element in div with {1} and {2} variables ',
        'simple text within div with {1} and {2} variables',
        'simple text within div 2 with {1} and {2} variables',
        'great grandchild text within div with {1} and {2} variables',
        'great grandchild text within div without id with {1} and {2} variables',
        'line item without id 1 with {1} and {2} variables',
        'line item without id 2 with {1} and {2} variables',
        'line item without id 3 with {1} and {2} variables',
        'line item with id 1 with {1} and {2} variables',
        'line item with id 2 with {1} and {2} variables',
        'line item with id 3 with {1} and {2} variables',
        'A paragraph with {1} is converted to {2}.',
        'A paragraph with {1}, {2}, and {3} is converted to {4}.',
        ' outermost text at the end with {1} and {2} variables '
      ],
      'PolymerDom.children.1.textContent.raw': [
        '1st compound parameter',
        '1st compound parameter',
        '1st compound parameter',
        '1st compound parameter',
        '1st compound parameter',
        '1st compound parameter',
        '1st compound parameter',
        '1st compound parameter',
        '1st compound parameter',
        '1st compound parameter',
        '1st compound parameter',
        '1st compound parameter',
        '1st compound parameter',
        '1st compound parameter',
        '1st compound parameter',
        '1st compound parameter',
        '1st compound parameter',
        '1st compound parameter',
        '1st compound parameter',
        '1st compound parameter',
        '1st compound parameter',
        '1st compound parameter',
        '1st compound parameter',
        '1st compound parameter',
        '1st compound parameter',
        '1st compound parameter',
        '1st compound parameter'
      ],
      'PolymerDom.children.2.textContent.raw': [
        '2nd compound parameter',
        '2nd compound parameter',
        '2nd compound parameter',
        '2nd compound parameter',
        '2nd compound parameter',
        '2nd compound parameter',
        '2nd compound parameter',
        '2nd compound parameter',
        '2nd compound parameter',
        '2nd compound parameter',
        '2nd compound parameter',
        '2nd compound parameter',
        '2nd compound parameter',
        '2nd compound parameter',
        '2nd compound parameter',
        '2nd compound parameter',
        '2nd compound parameter',
        '2nd compound parameter',
        '2nd compound parameter',
        '2nd compound parameter',
        '2nd compound parameter',
        '2nd compound parameter',
        '2nd compound parameter',
        '2nd compound parameter',
        '2nd compound parameter',
        '2nd compound parameter',
        '2nd compound parameter',
        '1st compound parameter',
        '2nd compound parameter'
      ]
    },
    { select: '[id="paragraph"] i18n-format',
      'PolymerDom.children.1.tagName': 'B',
      'PolymerDom.children.1.textContent': 'id',
      'PolymerDom.children.1.attributes.param.value.raw': '1',
      'PolymerDom.children.3.tagName': 'SPAN',
      'PolymerDom.children.3.textContent.raw': '2nd compound parameter',
      'PolymerDom.children.3.attributes.param.value.raw': '3'
    },
    { select: '[id="paragraph"] +i18n-format', 
      'PolymerDom.children.1.textContent.raw': '1st compound parameter'
    }
  ];

  var p = Object.setPrototypeOf || function (target, base) { 
    var obj = Object.create(base);
    for (var p in target) {
      obj[p] = target[p];
    }
    return obj;
  };
  var g = Object.getPrototypeOf;
  var _name = 'suite';
  var suiteMap = { null: {} };
  var s = function (name, baseName, extension) {
    if (suiteMap[name]) {
      throw new Error('duplicate suite name ' + name);
    }
    if (!suiteMap[baseName]) {
      throw new Error('inexistent base suite name ' + baseName);
    }
    extension[_name] = name;
    extension = p(extension, suiteMap[baseName]);
    suiteMap[name] = extension;
    return extension;
  };

  var suites = [
    s('simple text default', null, { 
      fixture: 'simple-text-element-default-fixture', 
      fixtureModel: undefined, 
      assign: undefined,
      lang: lang1,
      effectiveLang: lang1,
      templateDefaultLang: lang1,
      observeHtmlLang: true,
      text: text_simple,
      model: {},
      localDOM: localDOM_simple,
      lightDOM: undefined
    }),
    s('commented simple text default', 'simple text default', {
      fixture: 'commented-simple-text-element-default-fixture'
    }),
    s('simple text default null lang', 'simple text default', {
      assign: { lang: lang0 },
      lang: lang0,
      effectiveLang: lang0
    }),
    s('commented simple text default null lang', 'commented simple text default', { 
      assign: { lang: lang0 },
      lang: lang0,
      effectiveLang: lang0
    }),
    s(lang2 + ' simple text default', 'simple text default', {
      assign: { lang: lang2 },
      lang: lang2,
      effectiveLang: lang2
    }),
    s(lang2 + ' commented simple text default', 'commented simple text default', {
      assign: { lang: lang2 },
      lang: lang2,
      effectiveLang: lang2
    }),
    s('simple text null lang', 'simple text default', {
      fixture: 'simple-text-element-fixture',
      fixtureModel: { observeHtmlLang: false, lang: lang0 }, 
      lang: lang0,
      effectiveLang: lang0,
      observeHtmlLang: false
    }),
    s('simple text', 'simple text null lang', {
      assign: { lang: lang1 },
      lang: lang1,
      effectiveLang: lang1
    }),
    s(lang2 + ' simple text', 'simple text', {
      assign: { lang: lang2 },
      lang: lang2,
      effectiveLang: lang2
    }),
    s('commented simple text', 'simple text', {
      fixture: 'commented-simple-text-element-fixture'
    }),
    s('commented simple text null lang', 'commented simple text', {
      assign: undefined,
      lang: lang0,
      effectiveLang: lang0
    }),
    s(lang2 + ' commented simple text', 'commented simple text', {
      fixtureModel: { observeHtmlLang: false, lang: lang0 }, 
      assign: { lang: lang2 },
      lang: lang2,
      effectiveLang: lang2
    }),
    s(lang2 + ' static commented simple text', 'commented simple text', {
      fixtureModel: { observeHtmlLang: false, lang: lang2 }, 
      assign: undefined,
      lang: lang2,
      effectiveLang: lang2
    }),
    s('simple text id', 'simple text', {
      fixture: 'simple-text-id-element-fixture',
      text: text_simple_text_id,
      localDOM: localDOM_simple_text_id
    }),
    s(lang2 + ' simple text id', 'simple text id', {
      assign: { lang: lang2 },
      lang: lang2,
      effectiveLang: lang2
    }),
    s('plural gender', 'simple text default', {
      fixture: 'plural-gender-element-fixture', 
      fixtureModel: {
        observeHtmlLang: false,
        lang: lang0
      }, 
      assign: {
        lang: lang1,
        sender: sender1,
        recipients: recipients1
      },
      observeHtmlLang: false,
      event: 'local-dom-ready',
      text: text_plural_gender,
      localDOM: localDOM_plural_gender_1
    }),
    s('plural gender 2', 'plural gender', {
      assign: {
        lang: lang1,
        sender: sender1,
        recipients: recipients2
      },
      localDOM: localDOM_plural_gender_2
    }),
    s('plural gender 3', 'plural gender', {
      assign: {
        lang: lang1,
        sender: sender1,
        recipients: recipients3
      },
      localDOM: localDOM_plural_gender_3
    }),
    s('plural gender 4', 'plural gender', {
      assign: {
        lang: lang1,
        sender: sender1,
        recipients: recipients4
      },
      localDOM: localDOM_plural_gender_4
    }),
    s(lang2 + ' plural gender', 'plural gender', {
      assign: {
        lang: lang2,
        sender: sender1,
        recipients: recipients1
      },
      lang: lang2,
      effectiveLang: lang2
    }),
    s(lang2 + ' plural gender 2', 'plural gender 2', {
      assign: {
        lang: lang2,
        sender: sender1,
        recipients: recipients2
      },
      lang: lang2,
      effectiveLang: lang2,
      localDOM: localDOM_plural_gender_2
    }),
    s(lang2 + ' plural gender 3', 'plural gender 3', {
      assign: {
        lang: lang2,
        sender: sender1,
        recipients: recipients3
      },
      lang: lang2,
      effectiveLang: lang2,
      localDOM: localDOM_plural_gender_3
    }),
    s(lang2 + ' plural gender 4', 'plural gender 4', {
      assign: {
        lang: lang2,
        sender: sender1,
        recipients: recipients4
      },
      lang: lang2,
      effectiveLang: lang2,
      localDOM: localDOM_plural_gender_4
    }),
    s('simple attribute', 'simple text default', {
      fixture: 'simple-attribute-element-fixture', 
      fixtureModel: {
        observeHtmlLang: false,
        lang: lang0
      }, 
      assign: { lang: lang1 },
      observeHtmlLang: false,
      text: text_simple_attribute,
      model: model_simple_attribute,
      localDOM: localDOM_simple_attribute
    }),
    s(lang2 + ' simple attribute', 'simple attribute', {
      assign: { lang: lang2 },
      lang: lang2,
      effectiveLang: lang2
    }),
    s(lang4 + ' simple text default with fallback to ' + lang2, 'simple text default', {
      assign: { lang: lang4 },
      lang: lang2,
      effectiveLang: lang2
    }),
    s(lang4 + ' simple text with fallback to ' + lang2, 'simple text', {
      assign: { lang: lang4 },
      lang: lang2,
      effectiveLang: lang2
    }),
    s(lang5 + ' simple text with fallback to default', 'simple text', {
      assign: { lang: lang5 },
      lang: lang0,
      effectiveLang: lang0
    }),
    s(lang3 + ' simple text with fallback to default', 'simple text', {
      assign: { lang: lang3 },
      lang: lang0,
      effectiveLang: lang0
    }),
    s(lang4 + ' fallback text', 'simple text', {
      fixture: 'fallback-text-element-fixture', 
      assign: { lang: lang4 },
      lang: lang4,
      effectiveLang: lang4,
      rawText: true,
      text: text_fallback,
      localDOM: localDOM_fallback
    }),
    s('compound binding', 'simple text', {
      fixture: 'compound-binding-element-fixture',
      fixtureModel: {
        observeHtmlLang: false,
        lang: lang0,
        param1: param1,
        param2: param2
      },
      text: text_compound,
      localDOM: localDOM_compound
    }),
    s(lang2 + ' compound binding', 'compound binding', {
      fixtureModel: {
        observeHtmlLang: false,
        lang: lang0,
        param1: param1,
        param2: param2
      },
      assign: { lang: lang2 },
      lang: lang2,
      effectiveLang: lang2
    }),
    s('simple text dom bind', 'simple text', {
      fixture: 'simple-text-dom-bind',
      text: text_simple,
      localDOM: localDOM_simple
    }),
    s(lang2 + ' simple text dom bind', 'simple text dom bind', {
      assign: { lang: lang2 },
      lang: lang2,
      effectiveLang: lang2
    }),
    s('simple attribute dom bind', 'simple attribute', {
      fixture: 'simple-attribute-dom-bind', 
      fixtureModel: {
        observeHtmlLang: false,
        lang: lang1
      }, 
      assign: undefined,
      event: 'local-dom-ready',
      text: text_simple_attribute,
      model: model_simple_attribute,
      localDOM: localDOM_simple_attribute
    }),
    s(lang2 + ' simple attribute dom bind', 'simple attribute dom bind', {
      fixtureModel: {
        observeHtmlLang: false,
        lang: lang0
      },
      assign: { lang: lang2 },
      lang: lang2,
      effectiveLang: lang2
    }),
    s('compound binding dom bind', 'compound binding', {
      fixture: 'compound-binding-dom-bind'
    }),
    s(lang2 + ' compound binding dom bind', 'compound binding dom bind', {
      assign: { lang: lang2 },
      lang: lang2,
      effectiveLang: lang2
    })
  ];

/*
    { 
      suite: 'simple text', 
      fixture: 'simple-text-element', 
      fixtureModel: { observeHtmlLang: true, lang: lang0 }, 
      assign: {}, //{ lang: lang1 },
      lang: lang0,
      effectiveLang: lang0,
      templateDefaultLang: lang1,
      observeHtmlLang: true,
      childNodes: [
        { nodeName: '#text', data: 'Parameter ' },
        { nodeName: 'CONTENT', select: '[param=\'1\']' },
        { nodeName: '#text', data: ' and ' },
        { nodeName: 'CONTENT', select: '[param=\'2\']' },
        { nodeName: '#text', data: ' are rendered.' }
      ],
      parameters: [
        { select: 'b[param=\'1\']', textContent: 'A' },
        { select: 'i[param=\'2\']', textContent: 'B' }
      ]
    }
    { 
      suite: 'non-default static parameters', 
      fixture: 'non-default-attributes', 
      fixtureModel: undefined, 
      lang: lang2,
      paramAttribute: paramAttribute2,
      paramFormat: paramFormat2,
      childNodes: [
        { nodeName: '#text', data: 'Parameter ' },
        { nodeName: 'CONTENT', select: '[parameter=\'1\']' },
        { nodeName: '#text', data: ' and ' },
        { nodeName: 'CONTENT', select: '[parameter=\'2\']' },
        { nodeName: '#text', data: ' are rendered.' }
      ],
      parameters: [
        { select: 'b[parameter=\'1\']', textContent: 'A' },
        { select: 'i[parameter=\'2\']', textContent: 'B' }
      ]
    },
    { 
      suite: 'static bound values', 
      fixture: 'bound', 
      fixtureModel: {
        lang: 'en',
        text: [
          'Parameter {1} and {2} are rendered.',
          'A',
          'B'
        ]
      }, 
      lang: lang1,
      paramAttribute: paramAttribute1,
      paramFormat: paramFormat1,
      childNodes: [
        { nodeName: '#text', data: 'Parameter ' },
        { nodeName: 'CONTENT', select: '[param=\'1\']' },
        { nodeName: '#text', data: ' and ' },
        { nodeName: 'CONTENT', select: '[param=\'2\']' },
        { nodeName: '#text', data: ' are rendered.' }
      ],
      parameters: [
        { select: 'b[param=\'1\']', textContent: 'A' },
        { select: 'i[param=\'2\']', textContent: 'B' }
      ]
    },
    { 
      suite: 'static compound template', 
      fixture: 'compound-static', 
      fixtureModel: undefined,
      lang: lang1,
      paramAttribute: paramAttribute1,
      paramFormat: paramFormat1,
      childNodes: [
        { nodeName: '#text', data: 'You (' },
        { nodeName: 'CONTENT', select: '[param=\'3\']' },
        { nodeName: '#text', data: ') gave her (' },
        { nodeName: 'CONTENT', select: '[param=\'4\']' },
        { nodeName: '#text', data: ') and one other person ' },
        { nodeName: 'CONTENT', select: '[param=\'5\']' },
        { nodeName: '#text', data: '.' }
      ],
      parameters: [
        { select: 'i18n-number[param=\'1\']', number: 1, formatted: '1', 'root.PolymerDom.children.0.textContent': '1' },
        { select: 'span[param=\'2\']', textContent: 'female' },
        { select: 'span[param=\'3\']', textContent: 'Joe' },
        { select: 'span[param=\'4\']', textContent: 'Alice' },
        { select: 'span[param=\'5\']', textContent: 'a gift' }
      ]
    }
    { 
      suite: 'change text values', 
      fixture: 'bound', 
      fixtureModel: {
        lang: 'en',
        text: [
          'Parameter {1} and {2} are rendered.',
          'A',
          'B'
        ]
      }, 
      lang: lang1,
      paramAttribute: paramAttribute1,
      paramFormat: paramFormat1,
      assign: { 
        text: [
          'Param {2} and {1} are rendered.',
          'AAA',
          'BBB'
        ]
      },
      childNodes: [
        { nodeName: '#text', data: 'Param ' },
        { nodeName: 'CONTENT', select: '[param=\'2\']' },
        { nodeName: '#text', data: ' and ' },
        { nodeName: 'CONTENT', select: '[param=\'1\']' },
        { nodeName: '#text', data: ' are rendered.' }
      ],
      parameters: [
        { select: 'b[param=\'1\']', textContent: 'AAA' },
        { select: 'i[param=\'2\']', textContent: 'BBB' }
      ]
    },
    { 
      suite: 'change raw value', 
      fixture: 'bound', 
      fixtureModel: { number: '987654.321' }, 
      rawValue: rawValue1,
      offset: offset1,
      rawNumber: rawNumber1,
      number: number1,
      options: {},
      assign: { raw: rawValue1 },
      formatted: formatted1_en
    },
    { 
      suite: 'change lang value', 
      fixture: 'bound', 
      fixtureModel: { number: rawValue1 }, 
      rawValue: rawValue1,
      offset: offset1,
      rawNumber: rawNumber1,
      number: number1,
      options: {},
      assign: { lang: 'fr' },
      formatted: formatted1_fr
    },
    { 
      suite: 'change options object value', 
      fixture: 'bound', 
      fixtureModel: { number: rawValue1 }, 
      rawValue: rawValue1,
      offset: offset1,
      rawNumber: rawNumber1,
      number: number1,
      options: { 'style': 'currency', 'currency': 'USD' },
      assign: { options: { 'style': 'currency', 'currency': 'USD' } },
      formatted: formatted1_USD
    },
    { 
      suite: 'change options property values', 
      fixture: 'bound', 
      fixtureModel: { number: rawValue1 }, 
      rawValue: rawValue1,
      offset: offset1,
      rawNumber: rawNumber1,
      number: number1,
      options: { 'style': 'currency', 'currency': 'USD' },
      assign: { 'options': {}, 'options.style': 'currency', 'options.currency': 'USD' },
      formatted: formatted1_USD
    },
    { 
      suite: 'change currency options object value', 
      fixture: 'bound-currency-options', 
      fixtureModel: { number: rawValue1 }, 
      rawValue: rawValue1,
      offset: offset1,
      rawNumber: rawNumber1,
      number: number1,
      options: { 'style': 'currency', 'currency': 'JPY' },
      assign: { options: { 'style': 'currency', 'currency': 'JPY' } },
      formatted: formatted1_JPY
    },
    { 
      suite: 'change currency options property values', 
      fixture: 'bound-currency-options', 
      fixtureModel: { number: rawValue1 }, 
      rawValue: rawValue1,
      offset: offset1,
      rawNumber: rawNumber1,
      number: number1,
      options: { 'style': 'currency', 'currency': 'JPY' },
      assign: { 'options.currency': 'JPY' },
      formatted: formatted1_JPY
    },
    { 
      suite: 'default options object value', 
      fixture: 'bound-default-options', 
      fixtureModel: { number: rawValue1 }, 
      rawValue: rawValue1,
      offset: offset1,
      rawNumber: rawNumber1,
      number: number1,
      options: undefined,
      formatted: formatted1_en
    },
    { 
      suite: 'change options object value from default options', 
      fixture: 'bound-default-options', 
      fixtureModel: { number: rawValue1 }, 
      rawValue: rawValue1,
      offset: offset1,
      rawNumber: rawNumber1,
      number: number1,
      options: { 'style': 'currency', 'currency': 'USD' },
      assign: { options: { 'style': 'currency', 'currency': 'USD' } },
      formatted: formatted1_USD
    },
    { 
      suite: 'change options property values from default options', 
      fixture: 'bound-default-options', 
      fixtureModel: { number: rawValue1 }, 
      rawValue: rawValue1,
      offset: offset1,
      rawNumber: rawNumber1,
      number: number1,
      options: { 'style': 'currency', 'currency': 'USD' },
      assign: { 'options': {}, 'options.style': 'currency', 'options.currency': 'USD' },
      formatted: formatted1_USD
    },
    { 
      suite: 'change offset value', 
      fixture: 'bound', 
      fixtureModel: { number: rawValue1 }, 
      rawValue: rawValue1,
      offset: offset2,
      rawNumber: rawNumber1,
      number: number2,
      options: {},
      assign: { offset: offset2 },
      formatted: formatted1_offset
    },
    { 
      suite: 'invalid value', 
      fixture: 'bound', 
      fixtureModel: { number: rawValueInvalid }, 
      rawValue: rawValueInvalid,
      offset: offset1,
      rawNumber: NaN,
      number: NaN,
      options: {},
      formatted: 'NaN'
    },
    { 
      suite: 'invalid offset value', 
      fixture: 'bound', 
      fixtureModel: { number: rawValue1 }, 
      rawValue: rawValue1,
      offset: offsetInvalid,
      rawNumber: rawValue1,
      number: NaN,
      options: {},
      assign: { offset: offsetInvalid },
      formatted: 'NaN'
    }
*/

  var updateProperty = function (element, properties) {
    for (var name in properties) {
      var path = name.split(/[.]/);
      if (path.length === 1) {
        element[name] = properties[name];
      }
      else {
        var cursor = element;
        var p = path.shift();
        while (p) {
          if (path.length < 1) {
            cursor[p] = properties[name];
            element.notifyPath(name, properties[name], true);
            break;
          }
          else if (p === 'PolymerDom') {
            cursor = Polymer.dom(cursor);
          }
          else {
            cursor = cursor[p];
          }
          p = path.shift();
        }
      }
    }
  };

  var updateModel = function (element, model) {
    for (var name in model) {
      var path = name.split(/[.]/);
      if (path.length === 1) {
        element[name] = model[name];
        //console.log('updateModel: notifyPath: name = ' + name);
        //element.notifyPath(name, model[name], true);
      }
      else {
        var cursor = element;
        var p = path.shift();
        while (p) {
          if (path.length < 1) {
            cursor[p] = model[name];
            element.notifyPath(name, model[name], true);
            break;
          }
          else if (p === 'PolymerDom') {
            cursor = Polymer.dom(cursor);
          }
          else {
            cursor = cursor[p];
          }
          p = path.shift();
        }
      }
    }
  };

  var getProperty = function (target, name) {
    var path = name.split(/[.]/);
    if (path.length === 1) {
      return target[name];
    }
    else {
      var cursor = target;
      var p = path.shift();
      while (p) {
        //console.log(p, cursor);
        if (path.length < 1) {
          if (p === 'raw' ||
              p === 'text') {
            return cursor;
          }
          if (p === 'data') {
            cursor = cursor[p];
            cursor = cursor.replace(/^[\s]{1,}/g, ' ').replace(/[\s]{1,}$/g, ' ');
            return cursor;
          }
          else {
            return cursor[p];
          }
        }
        else if (p === 'PolymerDom') {
          cursor = Polymer.dom(cursor);
        }
        else if (p === 'previousTextSibling') {
          do {
            cursor = cursor.previousSibling;
          } while (cursor.nodeType === cursor.COMMENT_NODE ||
                   (cursor.nodeType === cursor.TEXT_NODE && cursor.data.match(/^[\s]*$/)));
        }
        else if (p === 'nextTextSibling') {
          do {
            cursor = cursor.nextSibling;
          } while (cursor.nodeType === cursor.COMMENT_NODE ||
                   (cursor.nodeType === cursor.TEXT_NODE && cursor.data.match(/^[\s]*$/)));
        }
        else {
          cursor = cursor[p];
        }
        p = path.shift();
      }
    }
  };

  function deepMap (target, source, map) {
    var value;
    for (var prop in source) {
      value = source[prop];
      switch (typeof value) {
      case 'string':
      case 'number':
      case 'boolean':
        if (typeof target === 'object') {
          target[prop] = map(value, prop);
        }
        break;
      case 'object':
        if (typeof target === 'object') {
          if (Array.isArray(value)) {
            target[prop] = target[prop] || [];
            deepMap(target[prop], value, map);
          }
          else {
            target[prop] = target[prop] || {};
            deepMap(target[prop], value, map);
          }
        }
        break;
      case 'function':
      case 'symbol':
      case 'undefined':
        if (typeof target === 'object') {
          target[prop] = value;
        }
        break;
      default:
        if (typeof target === 'object') {
          target[prop] = value;
        }
        break;
      }
    }
  }

  var translate = function (lang, path, text) {
    var result;
    switch (lang) {
    case '':
    case 'en':
    case null:
    case undefined:
      result = text;
      break;
    default:
      if (!path || path.match(/(textContent|[.]data|[.]text)$/)) {
        result = {};
        deepMap(result, { text: text }, function (value, prop) {
          if (typeof value === 'string' &&
              !value.match(/^({{[^{}]*}}|\[\[[^\[\]]*\]\])$/) &&
              !value.match(/^[0-9]{1,}$/) &&
              prop !== 'type') {
            return lang + ' ' + value;
          }
          return value;
        });
        result = result.text;
      }
      else {
        result = text;
      }
    }
    //console.log('translate (' + lang + ', ' + path + ', ' + JSON.stringify(text, null, 2) + ') = ' + JSON.stringify(result, null, 2));
    return result;
  };

  var setupFixture = function (params, fixtureModel) {
    var fixtureName = params.fixture;
    var e = document.querySelector('#' + fixtureName);
    var runningTest = document.querySelectorAll('.running-test');
    var title = document.querySelector('#test-name');
    var currentPath = window.location.pathname.split('/');
    if (!e) {
      throw new Error('Fixture element with id = ' + fixtureName + ' not found');
    }
    if (title) {
      title.textContent =
        (currentPath.length >= 2 ? currentPath[currentPath.length - 2] : '') +
        (currentPath.length >= 1 ? '/' + currentPath[currentPath.length - 1].replace(/-test[.]html$/, '') + '/': '') +
        params.suite;
    }
    if (e.is === 'i18n-dom-bind') {
      e.parentElement.classList.add('running-test');
      Array.prototype.forEach.call(runningTest, function (node) {
        if (node !== e.parentElement) {
          node.classList.remove('running-test');
        }
      });
      for (var p in fixtureModel) {
        e[p] = fixtureModel[p];
      }
      e.params = params;
      e.render();
      return e;
    }
    else {
      e.classList.add('running-test');
      Array.prototype.forEach.call(runningTest, function (node) {
        if (node !== e) {
          node.classList.remove('running-test');
        }
      });
      return fixture(fixtureName, fixtureModel);
    }
  };

  var restoreFixture = function (fixtureName) {
    var e = document.querySelector('#' + fixtureName);
    if (!e) {
      throw new Error('Fixture element with id = ' + fixtureName + ' not found');
    }
    if (e.is === 'i18n-dom-bind') {
      if (e._intervalId) {
        clearInterval(e._intervalId);
      }
    }
    else {
      e.restore();
    }
  };

  var getLocalDomRoot = function (e) {
    if (e.is === 'i18n-dom-bind') {
      return e.parentElement;
    }
    else if (e) {
      return e.root;
    }
    else {
      return null;
    }
  };

  suites.forEach(function (params) {

    suite(params.suite, function () {
      var el;
      var p;
      var n;
      var i, j;
      var results;
      var node;
      var rawValue = params.rawValue;
      var fixtureElement;
      var noProperties;
      var lang = params.assign && params.assign.lang ? params.assign.lang : 'en';
      var event = params.event ? params.event : 'lang-updated';

      suite(params.suite + ' lang property', function () {
        setup(function () {
          el = setupFixture(params, params.fixtureModel);
        });

        test('lang property is set as ' + params.lang, function (done) {
          if (params && params.assign && params.assign.lang) {
            el.addEventListener('lang-updated', function langIsSet (e) {
              if (el === Polymer.dom(e).rootTarget) {
                assert.equal(el, Polymer.dom(e).rootTarget, 'event target is the element');
                assert.isString(el.lang, 'lang property is a string');
                assert.equal(el.lang, params.lang, 'lang property is set');
                el.removeEventListener('lang-updated', langIsSet);
                done();
              }
            });
            updateProperty(el, params.assign);
          }
          else {
            updateProperty(el, params.assign);
            assert.isString(el.lang, 'lang property is a string');
            assert.equal(el.lang, params.lang, 'lang property is set');
            done();
          }
        });

        teardown(function () {
          restoreFixture(params.fixture);
        });
      });


      if (params && params.assign && params.assign.lang) {
        suite(params.suite + ' lang-updated event', function () {
          setup(function () {
            el = setupFixture(params, params.fixtureModel);
          });

          test('lang-updated event is fired', function (done) {
            el.addEventListener('lang-updated', function langUpdatedFired (e) {
              if (el === Polymer.dom(e).rootTarget) {
                assert.equal(el, Polymer.dom(e).rootTarget, 'event target is the element');
                el.removeEventListener('lang-updated', langUpdatedFired);
                done();
              }
            });
            updateProperty(el, params.assign);
          });

          teardown(function () {
            restoreFixture(params.fixture);
          });
        });
      }

      suite(params.suite + ' effectiveLang property', function () {
        setup(function () {
          el = setupFixture(params, params.fixtureModel);
        });

        test('effectiveLang property is set as ' + params.effectiveLang, function (done) {
          if (params && params.assign && params.assign.lang) {
            el.addEventListener('lang-updated', function effectiveLangIsSet (e) {
              if (el === Polymer.dom(e).rootTarget) {
                assert.equal(el, Polymer.dom(e).rootTarget, 'event target is the element');
                assert.isString(el.effectiveLang, 'effectiveLang property is a string');
                assert.equal(el.effectiveLang, params.effectiveLang, 'effectiveLang property is set');
                el.removeEventListener('lang-updated', effectiveLangIsSet);
                done();
              }
            });
            updateProperty(el, params.assign);
          }
          else {
            updateProperty(el, params.assign);
            assert.isString(el.effectiveLang, 'effectiveLang property is a string');
            assert.equal(el.effectiveLang, params.effectiveLang, 'effectiveLang property is set');
            done();
          }
        });

        teardown(function () {
          restoreFixture(params.fixture);
        });
      });

      suite(params.suite + ' templateDefaultLang property', function () {
        setup(function () {
          el = setupFixture(params, params.fixtureModel);
        });

        test('templateDefaultLang property is set as ' + params.templateDefaultLang, function (done) {
          if (params && params.assign && params.assign.lang) {
            el.addEventListener('lang-updated', function getTemplateDefaultLang (e) {
              if (el === Polymer.dom(e).rootTarget) {
                assert.equal(el, Polymer.dom(e).rootTarget, 'event target is the element');
                assert.isString(el.templateDefaultLang, 'templateDefaultLang property is a string');
                assert.equal(el.templateDefaultLang, params.templateDefaultLang, 'templateDefaultLang property is set');
                el.removeEventListener('lang-updated', getTemplateDefaultLang);
                done();
              }
            });
            updateProperty(el, params.assign);
          }
          else {
            updateProperty(el, params.assign);
            assert.isString(el.templateDefaultLang, 'templateDefaultLang property is a string');
            assert.equal(el.templateDefaultLang, params.templateDefaultLang, 'templateDefaultLang property is set');
            done();
          }
        });

        teardown(function () {
          restoreFixture(params.fixture);
        });
      });

      suite(params.suite + ' observeHtmlLang property', function () {
        setup(function () {
          el = setupFixture(params, params.fixtureModel);
        });

        test('observeHtmlLang property is set as ' + params.observeHtmlLang, function (done) {
          if (params && params.assign && params.assign.lang) {
            el.addEventListener('lang-updated', function getObserveHtmlLang (e) {
              if (el === Polymer.dom(e).rootTarget) {
                assert.equal(el, Polymer.dom(e).rootTarget, 'event target is the element');
                assert.isBoolean(el.observeHtmlLang, 'observeHtmlLang property is a Boolean');
                assert.equal(el.observeHtmlLang, params.observeHtmlLang, 'observeHtmlLang property is set');
                el.removeEventListener('lang-updated', getObserveHtmlLang);
                done();
              }
            });
            updateProperty(el, params.assign);
          }
          else {
            assert.isBoolean(el.observeHtmlLang, 'observeHtmlLang property is a Boolean');
            assert.equal(el.observeHtmlLang, params.observeHtmlLang, 'observeHtmlLang property is set');
            done();
          }
        });

        teardown(function () {
          restoreFixture(params.fixture);
        });
      });

      if (params.text) {
        suite(params.suite + ' text property', function () {
          setup(function () {
            el = setupFixture(params, params.fixtureModel);
          });

          test('text' + ' property is set as ' + JSON.stringify(params.text,null,2) + (params.assign && params.assign.lang ? ' for ' + params.assign.lang : ''), function (done) {
            noProperties = true;
            if (params && params.assign && params.assign.lang) {
              el.addEventListener('lang-updated', function textIsSet (e) {
                if (el === Polymer.dom(e).rootTarget) {
                  assert.equal(el, Polymer.dom(e).rootTarget, 'event target is the element');
                  assert.equal(el.lang, params.lang, 'lang is set as ' + params.lang);
                  assert.equal(el.effectiveLang, params.effectiveLang, 'effectiveLang is set as ' + params.effectiveLang);
                  assert.isObject(el.text, 'text property is an object');
                  //console.log(JSON.stringify(e.detail, null, 2));
                  //console.log(JSON.stringify(el.text, null, 2));
                  for (p in params.text) {
                    noProperties = false;
                    assert.deepEqual(el.text[p], params.rawText ? params.text[p] : translate(params.effectiveLang, null, params.text[p]), 'text.' + p + ' property is set for ' + params.effectiveLang);
                  }
                  el.removeEventListener('lang-updated', textIsSet);
                  done();
                }
              });
              updateProperty(el, params.assign);
            }
            else {
              updateProperty(el, params.assign);
              assert.isObject(el.text, 'text property is an object');
              assert.deepEqual(el.text[p], params.rawText ? params.text[p] : translate(el.effectiveLang, null, params.text[p]), 'text.' + p + ' property is set for ' + params.effectiveLang);
              done();
            }
            if (noProperties) {
              test('text property is set as ' + JSON.stringify(params.text), function () {
                updateProperty(el, params.assign);
                assert.isObject(el.text, 'text property is an object');
                assert.deepEqual(el.text, params.text, 'text property is set');
              });
            }
          });

          teardown(function () {
            restoreFixture(params.fixture);
          });
        });
      }

      if (params.model) {
        suite(params.suite + ' model property', function () {
          setup(function () {
            el = setupFixture(params, params.fixtureModel);
          });

          test('model' + ' property is set as ' + JSON.stringify(params.model,null,2) + (params.assign && params.assign.lang ? ' for ' + params.assign.lang : ''), function (done) {
            noProperties = true;
            if (params && params.assign && params.assign.lang) {
              el.addEventListener('lang-updated', function modelIsSet (e) {
                if (el.effectiveLang !== params.effectiveLang) {
                  console.log('discarding lang-updated event for ' + el.effectiveLang);
                  return true;
                }
                if (el === Polymer.dom(e).rootTarget) {
                  assert.equal(el, Polymer.dom(e).rootTarget, 'event target is the element');
                  assert.equal(el.lang, params.lang, 'lang is set as ' + params.lang);
                  assert.equal(el.effectiveLang, params.effectiveLang, 'effectiveLang is set as ' + params.effectiveLang);
                  assert.isObject(el.model, 'model property is an object');
                  for (p in params.model) {
                    noProperties = false;
                    //console.log('model.' + p + ' = ' + JSON.stringify(el.model[p]));
                    //console.log('expected model.' + p + ' = ' + JSON.stringify(translate(el.effectiveLang, null, params.model[p])));
                    assert.deepEqual(el.model[p], params.rawText ? params.text[p] : translate(params.effectiveLang, null, params.model[p]), 'model.' + p + ' property is set for ' + params.effectiveLang);
                  }
                  el.removeEventListener('lang-updated', modelIsSet);
                  done();
                }
              });
              updateProperty(el, params.assign);
            }
            else {
              updateProperty(el, params.assign);
              assert.isObject(el.model, 'model property is an object');
              assert.deepEqual(el.model[p], params.rawText ? params.text[p] : translate(params.effectiveLang, null, params.model[p]), 'model.' + p + ' property is set for ' + params.effectiveLang);
              done();
            }
            if (noProperties) {
              test('model property is set as ' + JSON.stringify(params.model), function () {
                updateProperty(el, params.assign);
                assert.isObject(el.model, 'model property is an object');
                assert.deepEqual(el.model, params.model, 'model property is set');
              });
            }
          });

          teardown(function () {
            restoreFixture(params.fixture);
          });
        });
      }

      if (params.localDOM) {
        suite(params.suite + ' local DOM', function () {
          setup(function () {
            el = setupFixture(params, params.fixtureModel);
          });

          test('local DOM ' + JSON.stringify(params.localDOM, null, 2) + ' is set' + 
                (params.assign && params.assign.lang ? ' for ' + params.assign.lang : ''), 
            function (done) {
              if (params && params.assign && params.assign.lang) {
                el.addEventListener(event, function localDomSet (e) {
                  if (el === Polymer.dom(e).rootTarget &&
                      el.lang === params.lang) {
                    assert.equal(el, Polymer.dom(e).rootTarget, 'event target is the element');
                    assert.equal(el.lang, params.lang, 'lang is set as ' + params.lang);
                    assert.equal(el.effectiveLang, params.effectiveLang, 'effectiveLang is set as ' + params.effectiveLang);
                    params.localDOM.forEach(function (childPath) {
                      var completeStatus;
                      var nodes = Polymer.dom(getLocalDomRoot(el)).querySelectorAll(childPath.select);
                      assert.ok(nodes.length > 0, childPath.select + ' is defined');
                      for (var p in childPath) {
                        if (p === 'select') {
                          continue;
                        }
                        //console.log(p + ' is set as ' + childPath[p]);
                        if (Array.isArray(childPath[p])) {
                          //console.log(nodes);
                          Array.prototype.forEach.call(childPath[p], function (path, i, a) {
                            assert.equal(getProperty(nodes[i], p), params.rawText ? path : translate(params.effectiveLang, p, path), p + ' is set as ' + translate(params.effectiveLang, p, path));
                          });
                        }
                        else {
                          //console.log(nodes[0]);
                          assert.equal(getProperty(nodes[0], p), params.rawText ? childPath[p] : translate(params.effectiveLang, p, childPath[p]), p + ' is set as ' + translate(params.effectiveLang, p, childPath[p]));
                        }
                      }
                      //console.log(childPath);
                    });
                    el.removeEventListener(event, localDomSet);
                    done();
                  }
                });
                updateProperty(el, params.assign);
              }
              else {
                updateProperty(el, params.assign);
                params.localDOM.forEach(function (childPath) {
                  var nodes = Polymer.dom(getLocalDomRoot(el)).querySelectorAll(childPath.select);
                  assert.ok(nodes.length > 0, childPath.select + ' is defined');
                  for (var p in childPath) {
                    if (p === 'select') {
                      continue;
                    }
                    //console.log(p + ' is set as ' + childPath[p]);
                    if (Array.isArray(childPath[p])) {
                      //console.log(nodes);
                      Array.prototype.forEach.call(childPath[p], function (path, i, a) {
                        assert.equal(getProperty(nodes[i], p), params.rawText ? path : translate(el.lang, p, path), p + ' is set as ' + translate(el.lang, p, path));
                      });
                    }
                    else {
                      //console.log(nodes[0]);
                      assert.equal(getProperty(nodes[0], p), params.rawText ? childPath[p] : translate(el.lang, p, childPath[p]), p + ' is set as ' + translate(el.lang, p, childPath[p]));
                    }
                  }
                  //console.log(childPath);
                });
                done();
              }
            }
          );

          teardown(function () {
            restoreFixture(params.fixture);
          });
        });
      }

      if (params.lightDOM) {
        suite(params.suite + ' light DOM', function () {
          setup(function () {
            el = setupFixture(params, params.fixtureModel);
          });

          test('light DOM ' + JSON.stringify(params.lightDOM, null, 2) + ' is set' + 
                (params.assign && params.assign.lang ? ' for ' + params.assign.lang : ''), 
            function (done) {
              if (params && params.assign && params.assign.lang) {
                el.addEventListener(event, function lightDomSet (e) {
                  if (el === Polymer.dom(e).rootTarget) {
                    assert.equal(el, Polymer.dom(e).rootTarget, 'event target is the element');
                    assert.equal(el.lang, params.lang, 'lang is set as ' + params.lang);
                    assert.equal(el.effectiveLang, params.effectiveLang, 'effectiveLang is set as ' + params.effectiveLang);
                    params.lightDOM.forEach(function (childPath) {
                      var completeStatus;
                      var nodes = Polymer.dom(el).querySelectorAll(childPath.select);
                      assert.ok(nodes.length > 0, childPath.select + ' is defined');
                      for (var p in childPath) {
                        if (p === 'select') {
                          continue;
                        }
                        //console.log(p + ' is set as ' + childPath[p]);
                        if (Array.isArray(childPath[p])) {
                          //console.log(nodes);
                          Array.prototype.forEach.call(childPath[p], function (path, i, a) {
                            assert.equal(getProperty(nodes[i], p), translate(params.effectiveLang, p, path), p + ' is set as ' + translate(params.effectiveLang, p, path));
                          });
                        }
                        else {
                          //console.log(nodes[0]);
                          assert.equal(getProperty(nodes[0], p), translate(params.effectiveLang, p, childPath[p]), p + ' is set as ' + translate(params.effectiveLang, p, childPath[p]));
                        }
                      }
                      //console.log(childPath);
                    });
                    el.removeEventListener(event, lightDomSet);
                    done();
                  }
                });
                updateProperty(el, params.assign);
              }
              else {
                updateProperty(el, params.assign);
                params.localDOM.forEach(function (childPath) {
                  var nodes = Polymer.dom(el).querySelectorAll(childPath.select);
                  assert.ok(nodes.length > 0, childPath.select + ' is defined');
                  for (var p in childPath) {
                    if (p === 'select') {
                      continue;
                    }
                    //console.log(p + ' is set as ' + childPath[p]);
                    if (Array.isArray(childPath[p])) {
                      //console.log(nodes);
                      Array.prototype.forEach.call(childPath[p], function (path, i, a) {
                        assert.equal(getProperty(nodes[i], p), translate(el.lang, p, path), p + ' is set as ' + translate(el.lang, p, path));
                      });
                    }
                    else {
                      //console.log(nodes[0]);
                      assert.equal(getProperty(nodes[0], p), translate(el.lang, p, childPath[p]), p + ' is set as ' + translate(el.lang, p, childPath[p]));
                    }
                  }
                  //console.log(childPath);
                });
                done();
              }
            }
          );

          teardown(function () {
            restoreFixture(params.fixture);
          });
        });
      }

/*
      test('childNodes are set as ' + JSON.stringify(params.childNodes), function () {
        updateProperty(el, params.assign);
        var childNodes = Polymer.dom(el.root).childNodes;
        var i;
        for (i = 0; i < params.childNodes.length; i++) {
          for (var p in params.childNodes[i]) {
            assert.equal(childNodes[i][p] || childNodes[i].getAttribute(p), params.childNodes[i][p], p + ' is set as ' + params.childNodes[i][p]);
          }
        }
      });

      test('parameters are set as ' + JSON.stringify(params.parameters), function () {
        updateProperty(el, params.assign);
        var i;
        for (i = 0; i < params.parameters.length; i++) {
          var node = Polymer.dom(el).querySelector(params.parameters[i].select);
          assert.isDefined(node, params.parameters[i].select + ' is defined');
          for (var p in params.parameters[i]) {
            if (p === 'select') {
              continue;
            }
            assert.equal(getProperty(node, p), params.parameters[i][p], p + ' is set as ' + params.parameters[i][p]);
          }
        }
      });

*/
    });
  });

  var boundSuites = [
  /*
    { 
      suite: 'change bound text values', 
      fixture: 'bound-and-wrapped',
      target: 'simple',
      fixtureModel: {
        lang: lang1,
        text: [
          'Parameter {1} and {2} are rendered.',
          'A',
          'B'
        ]
      }, 
      assign: { 
        text: [
          'Param {2} and {1} are re-rendered.',
          'AAA',
          'BBB'
        ]
      },
      lang: lang1,
      paramAttribute: paramAttribute1,
      paramFormat: paramFormat1,
      childNodes: [
        { nodeName: '#text', data: 'Param ' },
        { nodeName: 'CONTENT', select: '[param=\'2\']' },
        { nodeName: '#text', data: ' and ' },
        { nodeName: 'CONTENT', select: '[param=\'1\']' },
        { nodeName: '#text', data: ' are re-rendered.' }
      ],
      parameters: [
        { select: 'b[param=\'1\']', textContent: 'AAA' },
        { select: 'i[param=\'2\']', textContent: 'BBB' }
      ]
    },
    { 
      suite: 'plural category other', 
      fixture: 'bound-and-wrapped',
      target: 'compound',
      fixtureModel: {
        recipients: []
      },
      assign: { 
        recipients: [
          { name: 'Alice', gender: 'female' },
          { name: 'Bob', gender: 'male' },
          { name: 'Yoda', gender: 'other' }
        ]
      },
      lang: lang1,
      paramAttribute: paramAttribute1,
      paramFormat: paramFormat1,
      childNodes: [
        { nodeName: '#text', data: 'You (' },
        { nodeName: 'CONTENT', select: '[param=\'3\']' },
        { nodeName: '#text', data: ') gave them (' },
        { nodeName: 'CONTENT', select: '[param=\'4\']' },
        { nodeName: '#text', data: ') and ' },
        { nodeName: 'CONTENT', select: '[param=\'1\']' },
        { nodeName: '#text', data: ' other people gifts.' }
      ],
      parameters: [
        { select: 'i18n-number[param=\'1\']', number: 2, formatted: '2', 'root.PolymerDom.children.0.textContent': '2' },
        { select: 'span[param=\'2\']', textContent: 'female' },
        { select: 'span[param=\'3\']', textContent: 'Joe' },
        { select: 'span[param=\'4\']', textContent: 'Alice' },
        { select: 'span[param=\'5\']', textContent: 'a gift' }
      ]
    },
    { 
      suite: 'plural category one', 
      fixture: 'bound-and-wrapped',
      target: 'compound',
      fixtureModel: {
        recipients: []
      },
      assign: { 
        recipients: [
          { name: 'Alice', gender: 'female' },
          { name: 'Bob', gender: 'male' }
        ]
      },
      lang: lang1,
      paramAttribute: paramAttribute1,
      paramFormat: paramFormat1,
      childNodes: [
        { nodeName: '#text', data: 'You (' },
        { nodeName: 'CONTENT', select: '[param=\'3\']' },
        { nodeName: '#text', data: ') gave her (' },
        { nodeName: 'CONTENT', select: '[param=\'4\']' },
        { nodeName: '#text', data: ') and one other person ' },
        { nodeName: 'CONTENT', select: '[param=\'5\']' },
        { nodeName: '#text', data: '.' }
      ],
      parameters: [
        { select: 'i18n-number[param=\'1\']', number: 1, formatted: '1', 'root.PolymerDom.children.0.textContent': '1' },
        { select: 'span[param=\'2\']', textContent: 'female' },
        { select: 'span[param=\'3\']', textContent: 'Joe' },
        { select: 'span[param=\'4\']', textContent: 'Alice' },
        { select: 'span[param=\'5\']', textContent: 'a gift' }
      ]
    },
    { 
      suite: 'plural category 0', 
      fixture: 'bound-and-wrapped',
      target: 'compound',
      fixtureModel: {
        recipients: [
          { name: 'Alice', gender: 'female' },
          { name: 'Bob', gender: 'male' }
        ]
      },
      assign: { 
        recipients: []
      },
      lang: lang1,
      paramAttribute: paramAttribute1,
      paramFormat: paramFormat1,
      childNodes: [
        { nodeName: '#text', data: 'You (' },
        { nodeName: 'CONTENT', select: '[param=\'3\']' },
        { nodeName: '#text', data: ') gave no gifts.' }
      ],
      parameters: [
        { select: 'i18n-number[param=\'1\']', number: -1, formatted: '-1', rawNumber: 0, 'root.PolymerDom.children.0.textContent': '-1' },
        { select: 'span[param=\'2\']', textContent: '' },
        { select: 'span[param=\'3\']', textContent: 'Joe' },
        { select: 'span[param=\'4\']', textContent: '' },
        { select: 'span[param=\'5\']', textContent: 'a gift' }
      ]
    },
    { 
      suite: 'plural category 1', 
      fixture: 'bound-and-wrapped',
      target: 'compound',
      fixtureModel: {
        recipients: [
          { name: 'Alice', gender: 'female' },
          { name: 'Bob', gender: 'male' }
        ]
      },
      assign: { 
        recipients: [
          { name: 'Alice', gender: 'female' },
        ]
      },
      lang: lang1,
      paramAttribute: paramAttribute1,
      paramFormat: paramFormat1,
      childNodes: [
        { nodeName: '#text', data: 'You (' },
        { nodeName: 'CONTENT', select: '[param=\'3\']' },
        { nodeName: '#text', data: ') gave her (' },
        { nodeName: 'CONTENT', select: '[param=\'4\']' },
        { nodeName: '#text', data: ') ' },
        { nodeName: 'CONTENT', select: '[param=\'5\']' },
        { nodeName: '#text', data: '.' }
      ],
      parameters: [
        { select: 'i18n-number[param=\'1\']', number: 0, formatted: '0', rawNumber: 1, 'root.PolymerDom.children.0.textContent': '0' },
        { select: 'span[param=\'2\']', textContent: 'female' },
        { select: 'span[param=\'3\']', textContent: 'Joe' },
        { select: 'span[param=\'4\']', textContent: 'Alice' },
        { select: 'span[param=\'5\']', textContent: 'a gift' }
      ]
    },
    { 
      suite: 'update lang and re-render', 
      fixture: 'bound-and-wrapped',
      target: 'compound',
      fixtureModel: {
        lang: lang1,
        recipients: [
          { name: 'Alice', gender: 'female' },
          { name: 'Bob', gender: 'male' }
        ]
      },
      assign: { 
        lang: lang3 // 'ja' -> plural category 'other'
      },
      lang: lang3,
      paramAttribute: paramAttribute1,
      paramFormat: paramFormat1,
      childNodes: [
        { nodeName: '#text', data: 'You (' },
        { nodeName: 'CONTENT', select: '[param=\'3\']' },
        { nodeName: '#text', data: ') gave them (' },
        { nodeName: 'CONTENT', select: '[param=\'4\']' },
        { nodeName: '#text', data: ') and ' },
        { nodeName: 'CONTENT', select: '[param=\'1\']' },
        { nodeName: '#text', data: ' other people gifts.' }
      ],
      parameters: [
        { select: 'i18n-number[param=\'1\']', number: 1, formatted: '1', 'root.PolymerDom.children.0.textContent': '1' },
        { select: 'span[param=\'2\']', textContent: 'female' },
        { select: 'span[param=\'3\']', textContent: 'Joe' },
        { select: 'span[param=\'4\']', textContent: 'Alice' },
        { select: 'span[param=\'5\']', textContent: 'a gift' }
      ]
    },
    { 
      suite: 'empty text', 
      fixture: 'bound-and-wrapped',
      target: 'compound',
      fixtureModel: {
      },
      assign: { 
        compoundText: []
      },
      lang: lang1,
      paramAttribute: paramAttribute1,
      paramFormat: paramFormat1,
      childNodes: [],
      parameters: [
        { select: 'i18n-number[param=\'1\']', number: 2, formatted: '2', 'root.PolymerDom.children.0.textContent': '2' },
        { select: 'span[param=\'2\']', textContent: 'female' },
        { select: 'span[param=\'3\']', textContent: 'Joe' },
        { select: 'span[param=\'4\']', textContent: 'Alice' },
        { select: 'span[param=\'5\']', textContent: '' }
      ]
    },
    { 
      suite: 'illegal compound template', 
      fixture: 'bound-and-wrapped',
      target: 'compound',
      fixtureModel: {
      },
      assign: { 
        compoundText: [
          { 'illegal': 'illegal compound template' }
        ]
      },
      lang: lang1,
      paramAttribute: paramAttribute1,
      paramFormat: paramFormat1,
      childNodes: [],
      parameters: [
        { select: 'i18n-number[param=\'1\']', number: 2, formatted: '2', 'root.PolymerDom.children.0.textContent': '2' },
        { select: 'span[param=\'2\']', textContent: 'female' },
        { select: 'span[param=\'3\']', textContent: 'Joe' },
        { select: 'span[param=\'4\']', textContent: 'Alice' },
        { select: 'span[param=\'5\']', textContent: '' }
      ]
    },
    { 
      suite: 'change paramFormat', 
      fixture: 'bound-and-wrapped',
      target: 'compound',
      fixtureModel: {
        compoundText: [
          {
            '0': 'You (%3%) gave no gifts.',
            '1': {
              'male': 'You (%3%) gave him (%4%) %5%.',
              'female': 'You (%3%) gave her (%4%) %5%.',
              'other': 'You (%3%) gave them (%4%) %5%.'
            },
            'one': {
              'male': 'You (%3%) gave him (%4%) and one other person %5%.',
              'female': 'You (%3%) gave her (%4%) and one other person %5%.',
              'other': 'You (%3%) gave them (%4%) and one other person %5%.'
            },
            'other': 'You (%3%) gave them (%4%) and %1% other people gifts.'
          },
          '{{recipients.length}}', // dummy
          '{{recipients.0.gender}}', // dummy
          '{{sender.name}}', // dummy
          '{{recipients.0.name}}', // dummy
          'a gift'
        ],
        recipients: [
          { name: 'Alice', gender: 'female' },
          { name: 'Bob', gender: 'male' }
        ]
      },
      assign: {
        paramFormat: paramFormat2
      },
      lang: lang1,
      paramAttribute: paramAttribute1,
      paramFormat: paramFormat2,
      childNodes: [
        { nodeName: '#text', data: 'You (' },
        { nodeName: 'CONTENT', select: '[param=\'3\']' },
        { nodeName: '#text', data: ') gave her (' },
        { nodeName: 'CONTENT', select: '[param=\'4\']' },
        { nodeName: '#text', data: ') and one other person ' },
        { nodeName: 'CONTENT', select: '[param=\'5\']' },
        { nodeName: '#text', data: '.' }
      ],
      parameters: [
        { select: 'i18n-number[param=\'1\']', number: 1, formatted: '1', 'root.PolymerDom.children.0.textContent': '1' },
        { select: 'span[param=\'2\']', textContent: 'female' },
        { select: 'span[param=\'3\']', textContent: 'Joe' },
        { select: 'span[param=\'4\']', textContent: 'Alice' },
        { select: 'span[param=\'5\']', textContent: 'a gift' }
      ]
    },
    { 
      suite: 'change paramAttribute', 
      fixture: 'bound-and-wrapped',
      target: 'compound',
      fixtureModel: {
        recipients: [
          { name: 'Alice', gender: 'female' },
          { name: 'Bob', gender: 'male' }
        ]
      },
      assign: {
        paramAttribute: paramAttribute2
      },
      lang: lang1,
      paramAttribute: paramAttribute2,
      paramFormat: paramFormat1,
      childNodes: [
        { nodeName: '#text', data: 'You (' },
        { nodeName: 'CONTENT', select: '[parameter=\'3\']' },
        { nodeName: '#text', data: ') gave her (' },
        { nodeName: 'CONTENT', select: '[parameter=\'4\']' },
        { nodeName: '#text', data: ') and one other person ' },
        { nodeName: 'CONTENT', select: '[parameter=\'5\']' },
        { nodeName: '#text', data: '.' }
      ],
      parameters: [
        { select: 'i18n-number[parameter=\'1\']', number: 1, formatted: '1', 'root.PolymerDom.children.0.textContent': '1' },
        { select: 'span[parameter=\'2\']', textContent: 'female' },
        { select: 'span[parameter=\'3\']', textContent: 'Joe' },
        { select: 'span[parameter=\'4\']', textContent: 'Alice' },
        { select: 'span[parameter=\'5\']', textContent: 'a gift' }
      ]
    }
  */
  ];

  suite('bound in a local DOM', function () {
    var wrapper;
    var el;

    var reattach = function (placeholder) {
      var simple = Polymer.dom(placeholder).querySelector('#simple');
      var compound = Polymer.dom(placeholder).querySelector('#compound');
      Polymer.dom(placeholder).removeChild(simple);
      Polymer.dom(placeholder).appendChild(simple);
      Polymer.dom(placeholder).removeChild(compound);
      Polymer.dom(placeholder).appendChild(compound);
    };

    boundSuites.forEach(function (params) {

      [ false, true ].forEach(function (isReattach) {

        suite(params.suite + (isReattach ? ' with reattaching' : ''), function () {

          setup(function () {
            wrapper = fixture(params.fixture, params.fixtureModel);
            if (isReattach) {
              reattach(wrapper.$.placeholder);
            }
            el = wrapper.$[params.target];
          });

          test('lang property is ' + params.lang, function () {
            updateModel(wrapper, params.assign);
            assert.equal(el.lang, params.lang, 'lang is ' + params.lang);
          });

          test('paramAttribute property is ' + params.paramAttribute, function () {
            updateModel(wrapper, params.assign);
            assert.equal(el.paramAttribute, params.paramAttribute, 'paramAttribute is ' + params.paramAttribute);
          });

          test('paramFormat property is ' + params.paramFormat, function () {
            updateModel(wrapper, params.assign);
            assert.equal(el.paramFormat, params.paramFormat, 'paramFormat is ' + params.paramFormat);
          });

          test('updated childNodes are ' + JSON.stringify(params.childNodes), function (done) {
            el.addEventListener('rendered', function (e) {
              if (e.target === el) {
                var childNodes = Polymer.dom(el.root).childNodes;
                var i;
                for (i = 0; i < params.childNodes.length; i++) {
                  for (var p in params.childNodes[i]) {
                    assert.equal(childNodes[i][p] || childNodes[i].getAttribute(p), params.childNodes[i][p], p + ' is set as ' + params.childNodes[i][p]);
                  }
                }
                done();
              }
            });
            updateModel(wrapper, params.assign);
          });

          test('updated parameters are ' + JSON.stringify(params.parameters), function (done) {
            el.addEventListener('rendered', function (e) {
              if (e.target === el) {
                var i;
                for (i = 0; i < params.parameters.length; i++) {
                  var node = Polymer.dom(el).querySelector(params.parameters[i].select);
                  assert.isDefined(node, params.parameters[i].select + ' is defined');
                  for (var p in params.parameters[i]) {
                    if (p === 'select') {
                      continue;
                    }
                    assert.equal(getProperty(node, p), params.parameters[i][p], p + ' is set as ' + params.parameters[i][p]);
                  }
                }
                done();
              }
            });
            updateModel(wrapper, params.assign);
          });

    /*
          suite('bound value changed' 
                + (isReattach ? ' with reattaching' : ''), function () {
            setup(function () {
              el = wrapper.$.num;
            });

            test('change bound value to ' + rawNumber1, function (done) {
              el.addEventListener('rendered', function (e) {
                assert.equal(el.$.number.textContent, '123,456.789', 
                            'renders the formatted number');    
                done();
              });
              wrapper.number = rawNumber1;
            });

          });

          suite('bound value emptied' 
                + (isReattach ? ' with reattaching' : ''), function () {
            setup(function () {
              el = wrapper.$.num2;
            });

            test('change bound value to empty', function (done) {
              el.addEventListener('rendered', function (e) {
                assert.equal(el.$.number.textContent, '', 
                            'renders the formatted number');    
                done();
              });
              wrapper.number2 = '';
            });

          });

          suite('non-bound empty textContent changed' 
                + (isReattach ? ' with reattaching' : ''), function () {
            setup(function () {
              el = wrapper.$.empty;
            });

            test('change empty textContent value to ' + rawNumber1, function (done) {
              el.addEventListener('rendered', function (e) {
                assert.equal(el.$.number.textContent, '123,456.789', 
                            'renders the formatted number');    
                done();
              });
              Polymer.dom(el).textContent = rawNumber1;
            });

          });

          suite('currency options value changed' 
                + (isReattach ? ' with reattaching' : ''), function () {
            setup(function () {
              el = wrapper.$.currency;
            });

            test('change currency options value to JPY', function (done) {
              el.addEventListener('rendered', function (e) {
                assert.equal(el.$.number.textContent, '¥123,457', 
                            'renders the formatted currency');
                done();
              });
              wrapper.options.currency = 'JPY';
              wrapper.notifyPath('options.currency', wrapper.options.currency, true);
            });

          });

          suite('currency options value changed' 
                + (isReattach ? ' with reattaching' : ''), function () {
            setup(function () {
              el = wrapper.$.currency;
            });

            test('change currency options value to JPY and render()', function (done) {
              el.addEventListener('rendered', function (e) {
                assert.equal(el.$.number.textContent, '¥123,457', 
                            'renders the formatted currency');
                done();
              });
              wrapper.options.currency = 'JPY';
              el.render();
            });

          });

          suite('bound currency options value changed' 
                + (isReattach ? ' with reattaching' : ''), function () {
            setup(function () {
              el = wrapper.$.currency;
            });

            test('change bound currency options value to JPY', function (done) {
              el.addEventListener('rendered', function (e) {
                assert.equal(el.$.number.textContent, '¥123,457', 
                            'renders the formatted currency');
                done();
              });
              wrapper.$.currencySelector.select('JPY');
              //wrapper.notifyPath('options.currency', wrapper.options.currency, true);
            });

          });
    */
        });
      });
    });
  });

});
    </script>

  

</body></html>